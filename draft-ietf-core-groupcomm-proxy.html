<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Proxy Operations for CoAP Group Communication</title>
<meta content="Marco Tiloca" name="author">
<meta content="Esko Dijk" name="author">
<meta content="
       This document specifies the operations performed by a proxy, when using the Constrained Application Protocol (CoAP) in group communication scenarios. Such a proxy processes a single request sent by a client over unicast, and distributes the request to a group of servers, e.g., over UDP/IP multicast as the defined default transport protocol. Then, the proxy collects the individual responses from those servers and relays those responses back to the client, in a way that allows the client to distinguish the responses and their origin servers through embedded addressing information. This document updates RFC7252 with respect to caching of response messages at proxies. 
    " name="description">
<meta content="xml2rfc 3.23.2" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-core-groupcomm-proxy-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.23.2
    Python 3.12.7
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 4.9.4
    platformdirs 4.3.6
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-core-groupcomm-proxy.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Proxy Operations for Group Communication</td>
<td class="right">October 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Tiloca &amp; Dijk</td>
<td class="center">Expires 21 April 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">CoRE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-core-groupcomm-proxy-latest</dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a href="https://www.rfc-editor.org/rfc/rfc7252" class="eref">7252</a> (if approved)</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-10-18" class="published">18 October 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-04-21">21 April 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Tiloca</div>
<div class="org">RISE AB</div>
</div>
<div class="author">
      <div class="author-name">E. Dijk</div>
<div class="org">IoTconsultancy.nl</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Proxy Operations for CoAP Group Communication</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies the operations performed by a proxy, when using the Constrained Application Protocol (CoAP) in group communication scenarios. Such a proxy processes a single request sent by a client over unicast, and distributes the request to a group of servers, e.g., over UDP/IP multicast as the defined default transport protocol. Then, the proxy collects the individual responses from those servers and relays those responses back to the client, in a way that allows the client to distinguish the responses and their origin servers through embedded addressing information. This document updates RFC7252 with respect to caching of response messages at proxies.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Constrained RESTful Environments Working Group mailing list (core@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/core/">https://mailarchive.ietf.org/arch/browse/core/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/core-wg/groupcomm-proxy">https://github.com/core-wg/groupcomm-proxy</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 21 April 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-the-multicast-timeout-optio" class="internal xref">The Multicast-Timeout Option</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-the-reply-from-option" class="internal xref">The Reply-From Option</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-requirements-and-objectives" class="internal xref">Requirements and Objectives</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-protocol-description" class="internal xref">Protocol Description</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-request-sending-at-the-clie" class="internal xref">Request Sending at the Client</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="auto internal xref">5.1.1</a>.  <a href="#name-request-sending" class="internal xref">Request Sending</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="auto internal xref">5.1.2</a>.  <a href="#name-supporting-observe" class="internal xref">Supporting Observe</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-request-processing-at-the-p" class="internal xref">Request Processing at the Proxy</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-request-processing" class="internal xref">Request Processing</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="auto internal xref">5.2.2</a>.  <a href="#name-supporting-observe-2" class="internal xref">Supporting Observe</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-request-and-response-proces" class="internal xref">Request and Response Processing at the Server</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.1">
                    <p id="section-toc.1-1.5.2.3.2.1.1"><a href="#section-5.3.1" class="auto internal xref">5.3.1</a>.  <a href="#name-request-and-response-process" class="internal xref">Request and Response Processing</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.2">
                    <p id="section-toc.1-1.5.2.3.2.2.1"><a href="#section-5.3.2" class="auto internal xref">5.3.2</a>.  <a href="#name-supporting-observe-3" class="internal xref">Supporting Observe</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-response-processing-at-the-" class="internal xref">Response Processing at the Proxy</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.1">
                    <p id="section-toc.1-1.5.2.4.2.1.1"><a href="#section-5.4.1" class="auto internal xref">5.4.1</a>.  <a href="#name-response-processing" class="internal xref">Response Processing</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.2">
                    <p id="section-toc.1-1.5.2.4.2.2.1"><a href="#section-5.4.2" class="auto internal xref">5.4.2</a>.  <a href="#name-supporting-observe-4" class="internal xref">Supporting Observe</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="auto internal xref">5.5</a>.  <a href="#name-response-processing-at-the-c" class="internal xref">Response Processing at the Client</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5.2.1">
                    <p id="section-toc.1-1.5.2.5.2.1.1"><a href="#section-5.5.1" class="auto internal xref">5.5.1</a>.  <a href="#name-response-processing-2" class="internal xref">Response Processing</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5.2.2">
                    <p id="section-toc.1-1.5.2.5.2.2.1"><a href="#section-5.5.2" class="auto internal xref">5.5.2</a>.  <a href="#name-supporting-observe-5" class="internal xref">Supporting Observe</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="auto internal xref">5.6</a>.  <a href="#name-example" class="internal xref">Example</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-reverse-proxies" class="internal xref">Reverse-Proxies</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-processing-on-the-proxy-sid" class="internal xref">Processing on the Proxy Side</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-processing-on-the-client-si" class="internal xref">Processing on the Client Side</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-caching" class="internal xref">Caching</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-freshness-model" class="internal xref">Freshness Model</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-validation-model" class="internal xref">Validation Model</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2.2.1">
                    <p id="section-toc.1-1.7.2.2.2.1.1"><a href="#section-7.2.1" class="auto internal xref">7.2.1</a>.  <a href="#name-proxy-servers-revalidation-" class="internal xref">Proxy-Servers Revalidation with Unicast Requests</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2.2.2">
                    <p id="section-toc.1-1.7.2.2.2.2.1"><a href="#section-7.2.2" class="auto internal xref">7.2.2</a>.  <a href="#name-proxy-servers-revalidation-w" class="internal xref">Proxy-Servers Revalidation with Group Requests</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-client-proxy-revalidation-w" class="internal xref">Client-Proxy Revalidation with Group Requests</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-caching-of-end-to-end-prote" class="internal xref">Caching of End-To-End Protected Responses at Proxies</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4.2.1">
                    <p id="section-toc.1-1.7.2.4.2.1.1"><a href="#section-7.4.1" class="auto internal xref">7.4.1</a>.  <a href="#name-deterministic-requests-to-a" class="internal xref">Deterministic Requests to Achieve Cacheability</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4.2.2">
                    <p id="section-toc.1-1.7.2.4.2.2.1"><a href="#section-7.4.2" class="auto internal xref">7.4.2</a>.  <a href="#name-validation-of-responses" class="internal xref">Validation of Responses</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-chain-of-proxies" class="internal xref">Chain of Proxies</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-request-processing-at-the-pr" class="internal xref">Request Processing at the Proxy</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="auto internal xref">8.1.1</a>.  <a href="#name-supporting-observe-6" class="internal xref">Supporting Observe</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-response-processing-at-the-p" class="internal xref">Response Processing at the Proxy</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#section-8.2.1" class="auto internal xref">8.2.1</a>.  <a href="#name-supporting-observe-7" class="internal xref">Supporting Observe</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-http-to-coap-proxies" class="internal xref">HTTP-to-CoAP Proxies</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-the-http-multicast-timeout-" class="internal xref">The HTTP Multicast-Timeout Header Field</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-the-http-reply-from-header-" class="internal xref">The HTTP Reply-From Header Field</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-the-http-group-etag-header-" class="internal xref">The HTTP Group-ETag Header Field</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-request-sending-at-the-clien" class="internal xref">Request Sending at the Client</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="auto internal xref">9.5</a>.  <a href="#name-request-processing-at-the-pro" class="internal xref">Request Processing at the Proxy</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.6">
                <p id="section-toc.1-1.9.2.6.1"><a href="#section-9.6" class="auto internal xref">9.6</a>.  <a href="#name-response-processing-at-the-pr" class="internal xref">Response Processing at the Proxy</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7">
                <p id="section-toc.1-1.9.2.7.1"><a href="#section-9.7" class="auto internal xref">9.7</a>.  <a href="#name-response-processing-at-the-cl" class="internal xref">Response Processing at the Client</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.8">
                <p id="section-toc.1-1.9.2.8.1"><a href="#section-9.8" class="auto internal xref">9.8</a>.  <a href="#name-example-2" class="internal xref">Example</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.9">
                <p id="section-toc.1-1.9.2.9.1"><a href="#section-9.9" class="auto internal xref">9.9</a>.  <a href="#name-streamed-delivery-of-respon" class="internal xref">Streamed Delivery of Responses to the Client</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.10">
                <p id="section-toc.1-1.9.2.10.1"><a href="#section-9.10" class="auto internal xref">9.10</a>. <a href="#name-reverse-proxies-2" class="internal xref">Reverse-Proxies</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.10.2.1">
                    <p id="section-toc.1-1.9.2.10.2.1.1"><a href="#section-9.10.1" class="auto internal xref">9.10.1</a>.  <a href="#name-processing-on-the-client-sid" class="internal xref">Processing on the Client Side</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.10.2.2">
                    <p id="section-toc.1-1.9.2.10.2.2.1"><a href="#section-9.10.2" class="auto internal xref">9.10.2</a>.  <a href="#name-processing-on-the-proxy-side" class="internal xref">Processing on the Proxy Side</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-client-authentication" class="internal xref">Client Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-multicast-timeout-option" class="internal xref">Multicast-Timeout Option</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="auto internal xref">10.3</a>.  <a href="#name-reply-from-option" class="internal xref">Reply-From Option</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4">
                <p id="section-toc.1-1.10.2.4.1"><a href="#section-10.4" class="auto internal xref">10.4</a>.  <a href="#name-group-etag-option" class="internal xref">Group-ETag Option</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.5">
                <p id="section-toc.1-1.10.2.5.1"><a href="#section-10.5" class="auto internal xref">10.5</a>.  <a href="#name-http-to-coap-proxies-2" class="internal xref">HTTP-to-CoAP Proxies</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-coap-option-numbers-registr" class="internal xref">CoAP Option Numbers Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-hypertext-transfer-protocol" class="internal xref">Hypertext Transfer Protocol (HTTP) Field Name Registry</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="auto internal xref">12.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="auto internal xref">12.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-examples-with-reverse-proxy" class="internal xref">Examples with Reverse-Proxy</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-example-1" class="internal xref">Example 1</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-example-2-2" class="internal xref">Example 2</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#appendix-A.3" class="auto internal xref">A.3</a>.  <a href="#name-example-3" class="internal xref">Example 3</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-document-updates" class="internal xref">Document Updates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-version-02-to-03" class="internal xref">Version -02 to -03</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-version-01-to-02" class="internal xref">Version -01 to -02</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3">
                <p id="section-toc.1-1.14.2.3.1"><a href="#appendix-B.3" class="auto internal xref">B.3</a>.  <a href="#name-version-00-to-01" class="internal xref">Version -00 to -01</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> allows the presence of proxies, as intermediary entities supporting clients by performing requests on their behalf and relaying back responses.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">CoAP supports also group communication over IP multicast <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, where a group request can be addressed to multiple recipient servers, each of which may reply with an individual unicast response. As discussed in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.5" class="relref">Section 3.5</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, this group communication scenario poses a number of issues and limitations to proxy operations.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">In particular, the client sends to the proxy a single unicast request, which the proxy forwards to a group of CoAP servers, e.g., using UDP/IP multicast as the defined default transport protocol for CoAP group requests (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-1.1" class="relref">Section 1.1</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>). Later on, the proxy replies to the client's original unicast request, by relaying back the responses from the servers.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">As per <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, a CoAP-to-CoAP proxy relays those responses to the client as separate CoAP messages, all matching (by Token) with the client's original unicast request. A possible alternative approach for aggregating those responses into a single CoAP response sent to the client would require a specific aggregation Content-Format, which is not available yet. Both these approaches have open issues.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This document takes the former approach. That is, after forwarding a CoAP group request from the client to the group of CoAP servers, the proxy relays the individual responses back to the client as separate CoAP messages. The described method addresses all the related issues raised in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.5" class="relref">Section 3.5</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>. To this end, this document defines a dedicated signaling protocol based on two new CoAP options and used by the client and the proxy.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">By using this protocol, the client explicitly confirms its intent to perform a proxied group request and its support for receiving multiple responses as a result, i.e., one or more from each origin server. Also, the client signals for how long it is willing to wait for responses. When relaying to the client a response to the group request, the proxy indicates the addressing information of the origin server. This enables the client to distinguish multiple different responses by origin and to possibly contact one or more of the respective servers by sending individual unicast request(s) to the indicated address(es). In doing these follow-up unicast requests, the client may optionally bypass the proxy.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">Like <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, this document refers to UDP/IP multicast as the transport protocol that a proxy uses to forward a CoAP group request to a group of servers. While other transport protocols such as broadcast, non-IP multicast, and geocast can also be possible to employ, their use is not considered in this document.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">This document also defines how the proposed protocol is used between an HTTP client and an HTTP-to-CoAP cross-proxy, in order to forward an HTTP group request from the client to a group of CoAP servers, and relay back the individual CoAP responses as HTTP responses.<a href="#section-1-8" class="pilcrow">¶</a></p>
<p id="section-1-9">Finally, this document defines a caching model for proxies and specifies how they can serve a group request by using cached responses. Therefore, this document updates <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>.<a href="#section-1-9" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Readers are expected to be familiar with the terms and concepts from the following specifications:<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-3.1">
            <p id="section-1.1-3.1.1">CoAP <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> and Group Communication for CoAP <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>.<a href="#section-1.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-3.2">
            <p id="section-1.1-3.2.1">Object Security for Constrained RESTful Environments (OSCORE) <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> and Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>.<a href="#section-1.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-3.3">
            <p id="section-1.1-3.3.1">Concise Data Definition Language (CDDL) <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span>, Concise Binary Object Representation (CBOR) <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span>, and CBOR sequences <span>[<a href="#RFC8742" class="cite xref">RFC8742</a>]</span><a href="#section-1.1-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-3.4">
            <p id="section-1.1-3.4.1">Constrained Resource Identifiers (CRIs) <span>[<a href="#I-D.ietf-core-href" class="cite xref">I-D.ietf-core-href</a>]</span>.<a href="#section-1.1-3.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-4">Unless specified otherwise, the term "proxy" refers to a CoAP-to-CoAP forward-proxy, as defined in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.7.2" class="relref">Section 5.7.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">This document also uses the following terminology.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-6.1">
            <p id="section-1.1-6.1.1">Individual request: a request that an origin client sends to a single origin server within a group, either directly, or indirectly via a proxy.<a href="#section-1.1-6.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-multicast-timeout-option">
<section id="section-2">
      <h2 id="name-the-multicast-timeout-optio">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-the-multicast-timeout-optio" class="section-name selfRef">The Multicast-Timeout Option</a>
      </h2>
<p id="section-2-1">The Multicast-Timeout Option defined in this section has the properties summarized in <a href="#_table-multicast-timeout-option" class="auto internal xref">Table 1</a>, which extends Table 4 of <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Since the option is not Safe-to-Forward, the column "N" indicates a dash for "not applicable". The value of the Multicast-Timeout Option specifies a timeout value in seconds, encoded as an unsigned integer (see <span><a href="https://rfc-editor.org/rfc/rfc7252#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>).<a href="#section-2-2" class="pilcrow">¶</a></p>
<span id="name-the-multicast-timeout-option"></span><div id="_table-multicast-timeout-option">
<table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-the-multicast-timeout-option" class="selfRef">The Multicast-Timeout Option. C=Critical, U=Unsafe, N=NoCacheKey, R=Repeatable</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">No.</th>
            <th class="text-left" rowspan="1" colspan="1">C</th>
            <th class="text-left" rowspan="1" colspan="1">U</th>
            <th class="text-left" rowspan="1" colspan="1">N</th>
            <th class="text-left" rowspan="1" colspan="1">R</th>
            <th class="text-left" rowspan="1" colspan="1">Name</th>
            <th class="text-left" rowspan="1" colspan="1">Format</th>
            <th class="text-left" rowspan="1" colspan="1">Length</th>
            <th class="text-left" rowspan="1" colspan="1">Default</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">TBD1</td>
            <td class="text-left" rowspan="1" colspan="1"> </td>
            <td class="text-left" rowspan="1" colspan="1">x</td>
            <td class="text-left" rowspan="1" colspan="1">-</td>
            <td class="text-left" rowspan="1" colspan="1"> </td>
            <td class="text-left" rowspan="1" colspan="1">Multicast-Timeout</td>
            <td class="text-left" rowspan="1" colspan="1">uint</td>
            <td class="text-left" rowspan="1" colspan="1">0-4</td>
            <td class="text-left" rowspan="1" colspan="1">(none)</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-2-4">This document specifically defines how this option is used by a client in a CoAP request, to indicate to a proxy its support for and interest in receiving multiple responses to a proxied CoAP group request (i.e., one or more responses from each origin server) and for how long it is willing to wait for receiving responses via that proxy (see <a href="#ssec-req-send-steps" class="auto internal xref">Section 5.1.1</a> and <a href="#ssec-req-proc-proxy-steps" class="auto internal xref">Section 5.2.1</a>).<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">When sending a CoAP group request to a proxy via IP unicast, to be forwarded by the proxy to a targeted group of servers, the client includes the Multicast-Timeout Option into the request. The option value indicates after how much time in seconds the client will stop accepting responses matching its original unicast request, with the exception of notifications if the CoAP Observe Option <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span> is used in the same request. This allows the proxy to stop relaying responses back to the client, if those are received from servers after the indicated amount of time has elapsed.<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6">The Multicast-Timeout Option is of class U in terms of OSCORE processing (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-4.1" class="relref">Section 4.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>).<a href="#section-2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-reply-from-option">
<section id="section-3">
      <h2 id="name-the-reply-from-option">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-the-reply-from-option" class="section-name selfRef">The Reply-From Option</a>
      </h2>
<p id="section-3-1">The Reply-From Option defined in this section has the properties summarized in <a href="#_table-reply-from-option" class="auto internal xref">Table 2</a>, which extends Table 4 of <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>. The option is intended only for inclusion in CoAP responses, and builds on the Base-Uri Option from <span><a href="https://datatracker.ietf.org/doc/html/draft-bormann-coap-misc-27#section-3" class="relref">Section 3</a> of [<a href="#I-D.bormann-coap-misc" class="cite xref">I-D.bormann-coap-misc</a>]</span>.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">Since the option is intended only for responses, the column "N" indicates a dash for "not applicable".<a href="#section-3-2" class="pilcrow">¶</a></p>
<span id="name-the-reply-from-option-ccrit"></span><div id="_table-reply-from-option">
<table class="center" id="table-2">
        <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-the-reply-from-option-ccrit" class="selfRef">The Reply-From Option. C=Critical, U=Unsafe, N=NoCacheKey, R=Repeatable, (*) See below</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">No.</th>
            <th class="text-left" rowspan="1" colspan="1">C</th>
            <th class="text-left" rowspan="1" colspan="1">U</th>
            <th class="text-left" rowspan="1" colspan="1">N</th>
            <th class="text-left" rowspan="1" colspan="1">R</th>
            <th class="text-left" rowspan="1" colspan="1">Name</th>
            <th class="text-left" rowspan="1" colspan="1">Format</th>
            <th class="text-left" rowspan="1" colspan="1">Length</th>
            <th class="text-left" rowspan="1" colspan="1">Default</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">TBD2</td>
            <td class="text-left" rowspan="1" colspan="1"> </td>
            <td class="text-left" rowspan="1" colspan="1"> </td>
            <td class="text-left" rowspan="1" colspan="1">-</td>
            <td class="text-left" rowspan="1" colspan="1"> </td>
            <td class="text-left" rowspan="1" colspan="1">Reply-From</td>
            <td class="text-left" rowspan="1" colspan="1">(*)</td>
            <td class="text-left" rowspan="1" colspan="1">5-1034</td>
            <td class="text-left" rowspan="1" colspan="1">(none)</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-3-4">This document specifically defines how this option is used by a proxy that can perform proxied CoAP group requests.<a href="#section-3-4" class="pilcrow">¶</a></p>
<p id="section-3-5">Upon receiving a response to such a request from an origin server, the proxy includes the Reply-From Option into the response sent to the origin client (see <a href="#sec-description" class="auto internal xref">Section 5</a>). The proxy uses the option to indicate addressing information pertaining to that origin server, which the client can use in order to send an individual request intended to that server.<a href="#section-3-5" class="pilcrow">¶</a></p>
<p id="section-3-6">In particular, the client can use the addressing information specified in the option in order to identify the response originator and to possibly send it individual unicast requests later on, either directly or indirectly via the proxy.<a href="#section-3-6" class="pilcrow">¶</a></p>
<p id="section-3-7">When used as defined in this document, the option value is set to the byte serialization of a CBOR sequence <span>[<a href="#RFC8742" class="cite xref">RFC8742</a>]</span>, which is composed of at most two CBOR arrays.<a href="#section-3-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-8.1">
          <p id="section-3-8.1.1">The first CBOR array is <span class="bcp14">REQUIRED</span> and specifies a CRI (see <span>[<a href="#I-D.ietf-core-href" class="cite xref">I-D.ietf-core-href</a>]</span>). In particular, both 'scheme' and 'authority' are given, while 'path', 'query', and 'fragment' are not given.<a href="#section-3-8.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-8.2">
          <p id="section-3-8.2.1">The second CBOR array is <span class="bcp14">OPTIONAL</span> and specifies a CRI reference (see <span>[<a href="#I-D.ietf-core-href" class="cite xref">I-D.ietf-core-href</a>]</span>). In particular, 'scheme' is set to <code>null</code> (0xf6), at least one of 'authority' and 'path' is given, and both 'query' and 'fragment' are not given. This CRI reference is relevant in some scenarios where the proxy is a reverse-proxy.<a href="#section-3-8.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-3-9">The detailed use of this option is specified in <a href="#ssec-resp-proc-proxy-steps" class="auto internal xref">Section 5.4.1</a> and <a href="#ssec-resp-proc-client-steps" class="auto internal xref">Section 5.5.1</a> when the proxy is a forward-proxy, and in <a href="#sec-reverse-proxies-proxy-side" class="auto internal xref">Section 6.1</a> and <a href="#sec-reverse-proxies-client-side" class="auto internal xref">Section 6.2</a> when the proxy is a reverse-proxy.<a href="#section-3-9" class="pilcrow">¶</a></p>
<p id="section-3-10">The Reply-From Option is of class U in terms of OSCORE processing (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-4.1" class="relref">Section 4.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>).<a href="#section-3-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-objectives">
<section id="section-4">
      <h2 id="name-requirements-and-objectives">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-requirements-and-objectives" class="section-name selfRef">Requirements and Objectives</a>
      </h2>
<p id="section-4-1">In this section, the word "proxy" is not limited to forward-proxies. Instead, it comprises also reverse-proxies and HTTP-to-CoAP proxies.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">This document assumes that the following requirements are fulfilled.<a href="#section-4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-3.1">
          <p id="section-4-3.1.1">REQ1. The proxy is explicitly configured with an allow-list for performing proxied group requests on behalf of specific allowed clients.<a href="#section-4-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-3.2">
          <p id="section-4-3.2.1">REQ2. The proxy <span class="bcp14">MUST</span> identify a client sending a unicast group request to be proxied, in order to verify whether the client is allowed-listed to do so. For example, this can rely on one of the following security associations.<a href="#section-4-3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-3.2.2.1">
              <p id="section-4-3.2.2.1.1">A TLS <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> or DTLS <span>[<a href="#RFC9147" class="cite xref">RFC9147</a>]</span> channel between the client and the proxy, where the client has been authenticated during the secure channel establishment.<a href="#section-4-3.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-3.2.2.2">
              <p id="section-4-3.2.2.2.1">A pairwise OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> Security Context between the client and the proxy, as defined in <span>[<a href="#I-D.ietf-core-oscore-capable-proxies" class="cite xref">I-D.ietf-core-oscore-capable-proxies</a>]</span>.<a href="#section-4-3.2.2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
        <li class="normal" id="section-4-3.3">
          <p id="section-4-3.3.1">REQ3. If end-to-end secure communication is required between the client and the servers in the CoAP group, exchanged messages <span class="bcp14">MUST</span> be protected by using Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>, as discussed in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-5" class="relref">Section 5</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>. This requires the client and the servers to have previously joined the correct OSCORE group, for instance by using the approach described in <span>[<a href="#I-D.ietf-ace-key-groupcomm-oscore" class="cite xref">I-D.ietf-ace-key-groupcomm-oscore</a>]</span>. The correct OSCORE group to join can be pre-configured or alternatively discovered, for instance by using the approach described in <span>[<a href="#I-D.tiloca-core-oscore-discovery" class="cite xref">I-D.tiloca-core-oscore-discovery</a>]</span>.<a href="#section-4-3.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-4">This document defines how to achieve the following objectives.<a href="#section-4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-5.1">
          <p id="section-4-5.1.1">OBJ1. The proxy gets an indication from the client that the client is in fact interested in multiple responses to a proxied group request and is capable to handle those. With particular reference to a unicast CoAP group request sent to the proxy, this means that the client is capable to receive those responses as separate CoAP responses, each matching with the original unicast request.<a href="#section-4-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-5.2">
          <p id="section-4-5.2.1">OBJ2. The proxy learns for how long it should wait for responses to a proxied group request, before starting to ignore following responses to it (except for notifications, if a CoAP Observe Option is used <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>).<a href="#section-4-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-5.3">
          <p id="section-4-5.3.1">OBJ3. The proxy relays to the client any multiple responses to the proxied group request. With particular reference to a client's original CoAP unicast request sent to the proxy, those responses are sent to the client as separate CoAP responses, each matching with the original unicast request.<a href="#section-4-5.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-5.4">
          <p id="section-4-5.4.1">OBJ4. The client is able to distinguish the different responses to the proxied group request, as well as their corresponding origin servers.<a href="#section-4-5.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-5.5">
          <p id="section-4-5.5.1">OBJ5. The client is enabled to optionally contact one or more of the responding origin servers in the future, either directly or via the proxy.<a href="#section-4-5.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="sec-description">
<section id="section-5">
      <h2 id="name-protocol-description">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-protocol-description" class="section-name selfRef">Protocol Description</a>
      </h2>
<p id="section-5-1">This section specifies the steps of the signaling protocol.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="ssec-req-send-client">
<section id="section-5.1">
        <h3 id="name-request-sending-at-the-clie">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-request-sending-at-the-clie" class="section-name selfRef">Request Sending at the Client</a>
        </h3>
<p id="section-5.1-1">This section defines the operations performed by the client, for sending a request targeting a group of servers via the proxy.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<div id="ssec-req-send-steps">
<section id="section-5.1.1">
          <h4 id="name-request-sending">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-request-sending" class="section-name selfRef">Request Sending</a>
          </h4>
<p id="section-5.1.1-1">The client proceeds according to the following steps.<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1.1-2">
<li id="section-5.1.1-2.1">
              <p id="section-5.1.1-2.1.1">The client prepares a unicast CoAP group request addressed to the proxy, and specifies the group URI where the request has to be forwarded to.<a href="#section-5.1.1-2.1.1" class="pilcrow">¶</a></p>
<p id="section-5.1.1-2.1.2">
The client can specify the group URI as a string in the Proxy-Uri Option, or by using the Proxy-Scheme Option together with the Uri-* options (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.5.1" class="relref">Section 3.5.1</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>).<a href="#section-5.1.1-2.1.2" class="pilcrow">¶</a></p>
<p id="section-5.1.1-2.1.3">
Alternatively, the client can rely on the analogous options defined in <span>[<a href="#I-D.ietf-core-href" class="cite xref">I-D.ietf-core-href</a>]</span>, i.e., on the Proxy-Cri Option conveying a CRI equivalent to the group URI, or on the Proxy-Scheme-Number Option together with the Uri-* options.<a href="#section-5.1.1-2.1.3" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.1.1-2.2">
              <p id="section-5.1.1-2.2.1">The client <span class="bcp14">MUST</span> retain the Token value used for this original unicast request beyond the reception of a first CoAP response matching with it. To this end, the client follows the same rules for Token retention defined for multicast CoAP requests in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.1.5" class="relref">Section 3.1.5</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>.<a href="#section-5.1.1-2.2.1" class="pilcrow">¶</a></p>
<p id="section-5.1.1-2.2.2">
In particular, the client picks an amount of time T that it is fine to wait for before freeing up the Token value. Specifically, the value of T <span class="bcp14">MUST</span> be such that:<a href="#section-5.1.1-2.2.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.1-2.2.3.1">
                  <p id="section-5.1.1-2.2.3.1.1">T &lt; T_r , where T_r is the amount of time that the client is fine to wait for before potentially reusing the Token value. Note that T_r <span class="bcp14">MUST NOT</span> be less than MIN_TOKEN_REUSE_TIME defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.1.5" class="relref">Section 3.1.5</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>.<a href="#section-5.1.1-2.2.3.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.1.1-2.2.3.2">
                  <p id="section-5.1.1-2.2.3.2.1">T should be at least the expected worst-case time taken by the request and response processing on the proxy and on the servers in the addressed CoAP group.<a href="#section-5.1.1-2.2.3.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.1.1-2.2.3.3">
                  <p id="section-5.1.1-2.2.3.3.1">T should be at least the expected worst-case round-trip delay between the client and the proxy plus the worst-case round-trip delay between the proxy and any of the origin servers.<a href="#section-5.1.1-2.2.3.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li id="section-5.1.1-2.3">
              <p id="section-5.1.1-2.3.1">The client <span class="bcp14">MUST</span> include the Multicast-Timeout Option defined in <a href="#sec-multicast-timeout-option" class="auto internal xref">Section 2</a> into the unicast request to send to the proxy. The option value specifies an amount of time T' &lt; T. The difference (T - T') should be at least the expected worst-case round-trip time between the client and the proxy.<a href="#section-5.1.1-2.3.1" class="pilcrow">¶</a></p>
<p id="section-5.1.1-2.3.2">
The client can specify T' = 0 as option value, thus indicating to be not interested in receiving responses from the origin servers through the proxy. In such a case, the client <span class="bcp14">SHOULD</span> also include a No-Response Option <span>[<a href="#RFC7967" class="cite xref">RFC7967</a>]</span> with value 26 (suppress all response codes), if it supports the option.<a href="#section-5.1.1-2.3.2" class="pilcrow">¶</a></p>
<p id="section-5.1.1-2.3.3">
Consistently, if the unicast request to send to the proxy already included a No-Response Option with value 26, the client <span class="bcp14">SHOULD</span> specify T' = 0 as value of the Multicast-Timeout Option.<a href="#section-5.1.1-2.3.3" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.1.1-2.4">
              <p id="section-5.1.1-2.4.1">The client processes the request as defined in <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, and also as in <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span> when secure group communication is used between the client and the servers.<a href="#section-5.1.1-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.1.1-2.5">
              <p id="section-5.1.1-2.5.1">The client sends the request to the proxy as a unicast CoAP message. When doing so, the client protects the request according to the security association that it has with the proxy.<a href="#section-5.1.1-2.5.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-5.1.1-3">The exact method that the client uses to estimate the worst-case processing times and round-trip delays mentioned above is out of the scope of this document. However, such a method is expected to be already used by the client when generally determining an appropriate Token lifetime and reuse interval.<a href="#section-5.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-req-send-observe">
<section id="section-5.1.2">
          <h4 id="name-supporting-observe">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-supporting-observe" class="section-name selfRef">Supporting Observe</a>
          </h4>
<p id="section-5.1.2-1">When using CoAP Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, the client follows what is specified in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.7" class="relref">Section 3.7</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, with the difference that it sends a unicast request to the proxy, to be forwarded to the group of servers as defined in <a href="#ssec-req-send-steps" class="auto internal xref">Section 5.1.1</a> of this document.<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<p id="section-5.1.2-2">Furthermore, the client especially follows what is specified in <span><a href="https://rfc-editor.org/rfc/rfc7641#section-5" class="relref">Section 5</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, i.e., it registers its interest to be an observer with the proxy, as if it was communicating with the servers.<a href="#section-5.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ssec-req-proc-proxy">
<section id="section-5.2">
        <h3 id="name-request-processing-at-the-p">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-request-processing-at-the-p" class="section-name selfRef">Request Processing at the Proxy</a>
        </h3>
<p id="section-5.2-1">This section defines the operations performed by the proxy, when receiving a request to forward to a group of servers.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<div id="ssec-req-proc-proxy-steps">
<section id="section-5.2.1">
          <h4 id="name-request-processing">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-request-processing" class="section-name selfRef">Request Processing</a>
          </h4>
<p id="section-5.2.1-1">Upon receiving the request from the client, the proxy proceeds according to the following steps.<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.2.1-2">
<li id="section-5.2.1-2.1">
              <p id="section-5.2.1-2.1.1">The proxy decrypts and verifies the request, according to the security association that it has with the client.<a href="#section-5.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.2.1-2.2">
              <p id="section-5.2.1-2.2.1">The proxy identifies the client, and verifies that the client is in fact allowed-listed to have its requests proxied to CoAP group URIs.<a href="#section-5.2.1-2.2.1" class="pilcrow">¶</a></p>
<p id="section-5.2.1-2.2.2">
If the verification fails, the proxy <span class="bcp14">MUST</span> stop processing the request and <span class="bcp14">MUST</span> reply to the client with a 4.01 (Unauthorized) response. The proxy protects the response according to the security association that it has with the client.<a href="#section-5.2.1-2.2.2" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.2.1-2.3">
              <p id="section-5.2.1-2.3.1">The proxy verifies the presence of the Multicast-Timeout Option, as a confirmation that the client is fine to receive multiple CoAP responses matching with the same original request.<a href="#section-5.2.1-2.3.1" class="pilcrow">¶</a></p>
<p id="section-5.2.1-2.3.2">
If the Multicast-Timeout Option is not present, the proxy <span class="bcp14">MUST</span> stop processing the request and <span class="bcp14">MUST</span> reply to the client with a 4.00 (Bad Request) response. The proxy protects the response according to the security association that it has with the client.<a href="#section-5.2.1-2.3.2" class="pilcrow">¶</a></p>
<p id="section-5.2.1-2.3.3">
The response <span class="bcp14">MUST</span> include a Multicast-Timeout Option, whose value <span class="bcp14">MUST</span> be set to 0. As per <span><a href="https://rfc-editor.org/rfc/rfc7252#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, this is represented with an empty option value (a zero-length sequence of bytes). By doing so, the proxy indicates that the Multicast-Timeout Option was missing and has to be included in the request. As per <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.9.2" class="relref">Section 5.9.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> The response <span class="bcp14">SHOULD</span> include a diagnostic payload.<a href="#section-5.2.1-2.3.3" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.2.1-2.4">
              <p id="section-5.2.1-2.4.1">The proxy retrieves the value T' from the Multicast-Timeout Option, and then removes the option from the client's request.<a href="#section-5.2.1-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.2.1-2.5">
              <p id="section-5.2.1-2.5.1">The proxy forwards the client's request to the group of servers. In particular, the proxy sends it as a CoAP group request over IP multicast, addressed to the group URI specified by the client.<a href="#section-5.2.1-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.2.1-2.6">
              <p id="section-5.2.1-2.6.1">The proxy sets a timeout with the value T' retrieved from the Multicast-Timeout Option of the original unicast request.<a href="#section-5.2.1-2.6.1" class="pilcrow">¶</a></p>
<p id="section-5.2.1-2.6.2">
In case T' &gt; 0, the proxy will ignore responses to the forwarded group request coming from servers, if received after the timeout expiration, with the exception of Observe notifications (see <a href="#ssec-resp-proc-proxy" class="auto internal xref">Section 5.4</a>).<a href="#section-5.2.1-2.6.2" class="pilcrow">¶</a></p>
<p id="section-5.2.1-2.6.3">
In case T' = 0, the proxy will ignore all responses to the forwarded group request coming from servers.<a href="#section-5.2.1-2.6.3" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-5.2.1-3">If the proxy supports caching of responses, it can serve the original unicast request also by using cached responses, as per <a href="#sec-proxy-caching" class="auto internal xref">Section 7</a>.<a href="#section-5.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-req-proc-proxy-observe">
<section id="section-5.2.2">
          <h4 id="name-supporting-observe-2">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-supporting-observe-2" class="section-name selfRef">Supporting Observe</a>
          </h4>
<p id="section-5.2.2-1">When using CoAP Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, the proxy takes the role of the client and registers its own interest to observe the target resource with the servers as per <span><a href="https://rfc-editor.org/rfc/rfc7641#section-5" class="relref">Section 5</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>.<a href="#section-5.2.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2.2-2">When doing so, the proxy especially follows what is specified for the client in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.7" class="relref">Section 3.7</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, by forwarding the group request to the servers over IP multicast as defined in <a href="#ssec-req-proc-proxy-steps" class="auto internal xref">Section 5.2.1</a> of this document.<a href="#section-5.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ssec-req-resp-proc-server">
<section id="section-5.3">
        <h3 id="name-request-and-response-proces">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-request-and-response-proces" class="section-name selfRef">Request and Response Processing at the Server</a>
        </h3>
<p id="section-5.3-1">This section defines the operations performed by the server, when receiving a group request from the proxy.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<div id="ssec-req-resp-proc-server-steps">
<section id="section-5.3.1">
          <h4 id="name-request-and-response-process">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-request-and-response-process" class="section-name selfRef">Request and Response Processing</a>
          </h4>
<p id="section-5.3.1-1">Upon receiving the request from the proxy, the server proceeds according to the following steps.<a href="#section-5.3.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3.1-2">
<li id="section-5.3.1-2.1">
              <p id="section-5.3.1-2.1.1">The server processes the group request as defined in <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, and also as in <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span> when secure group communication is used between the client and the server.<a href="#section-5.3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.3.1-2.2">
              <p id="section-5.3.1-2.2.1">The server processes the response to be relayed to the client as defined in <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, and also as in <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span> when secure group communication is used between the client and the server.<a href="#section-5.3.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="ssec-req-resp-proc-server-observe">
<section id="section-5.3.2">
          <h4 id="name-supporting-observe-3">
<a href="#section-5.3.2" class="section-number selfRef">5.3.2. </a><a href="#name-supporting-observe-3" class="section-name selfRef">Supporting Observe</a>
          </h4>
<p id="section-5.3.2-1">When using CoAP Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, the server especially follows what is specified in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.7" class="relref">Section 3.7</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span> and <span><a href="https://rfc-editor.org/rfc/rfc7641#section-5" class="relref">Section 5</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>.<a href="#section-5.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ssec-resp-proc-proxy">
<section id="section-5.4">
        <h3 id="name-response-processing-at-the-">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-response-processing-at-the-" class="section-name selfRef">Response Processing at the Proxy</a>
        </h3>
<p id="section-5.4-1">This section defines the operations performed by the proxy, when receiving a response matching with a forwarded group request.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<div id="ssec-resp-proc-proxy-steps">
<section id="section-5.4.1">
          <h4 id="name-response-processing">
<a href="#section-5.4.1" class="section-number selfRef">5.4.1. </a><a href="#name-response-processing" class="section-name selfRef">Response Processing</a>
          </h4>
<p id="section-5.4.1-1">Upon receiving a response matching with the group request before the amount of time T' has elapsed (see Step 6 in <a href="#ssec-req-proc-proxy-steps" class="auto internal xref">Section 5.2.1</a>), the proxy proceeds according to the following steps.<a href="#section-5.4.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.4.1-2">
<li id="section-5.4.1-2.1">
              <p id="section-5.4.1-2.1.1">The proxy <span class="bcp14">MUST</span> include the Reply-From Option defined in <a href="#sec-reply-from-option" class="auto internal xref">Section 3</a> into the response. The proxy sets the option value as follows.<a href="#section-5.4.1-2.1.1" class="pilcrow">¶</a></p>
<p id="section-5.4.1-2.1.2">
The CRI present as first element of the CBOR sequence specifies the addressing information of the server generating the response. The second element of the CBOR sequence <span class="bcp14">MUST NOT</span> be present.<a href="#section-5.4.1-2.1.2" class="pilcrow">¶</a></p>
<p id="section-5.4.1-2.1.3">
If the proxy supports caching of responses (see <a href="#sec-proxy-caching" class="auto internal xref">Section 7</a>), the proxy <span class="bcp14">MUST</span> include the Reply-From Option into the response before caching the response. This ensures that a response to a group request conveys the addressing information of the origin server that generated the response, also when the response is forwarded to a client as retrieved from the proxy's cache.<a href="#section-5.4.1-2.1.3" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.4.1-2.2">
              <p id="section-5.4.1-2.2.1">The proxy forwards the response back to the client. When doing so, the proxy protects the response according to the security association that it has with the client.<a href="#section-5.4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-5.4.1-3">As discussed in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.1.6" class="relref">Section 3.1.6</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, it is possible that a same server replies with multiple responses to the same group request, i.e., with the same Token. As long as the proxy forwards responses to a group request back to the origin client, the proxy <span class="bcp14">MUST</span> follow the steps defined above and forward also such multiple responses "as they come".<a href="#section-5.4.1-3" class="pilcrow">¶</a></p>
<p id="section-5.4.1-4">Upon timeout expiration, i.e., T' seconds after having sent the group request over IP multicast, the proxy frees up its local Token value associated with that request. Thus, following late responses to the same group request will be discarded and not forwarded back to the client.<a href="#section-5.4.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-resp-proc-proxy-observe">
<section id="section-5.4.2">
          <h4 id="name-supporting-observe-4">
<a href="#section-5.4.2" class="section-number selfRef">5.4.2. </a><a href="#name-supporting-observe-4" class="section-name selfRef">Supporting Observe</a>
          </h4>
<p id="section-5.4.2-1">When using CoAP Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, the proxy acts as a client registered with the servers, as described earlier in <a href="#ssec-req-proc-proxy-observe" class="auto internal xref">Section 5.2.2</a>.<a href="#section-5.4.2-1" class="pilcrow">¶</a></p>
<p id="section-5.4.2-2">Furthermore, the proxy takes the role of a server when forwarding notifications from origin servers back to the client. To this end, the proxy follows what is specified in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.7" class="relref">Section 3.7</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span> and <span><a href="https://rfc-editor.org/rfc/rfc7641#section-5" class="relref">Section 5</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, with the following additions.<a href="#section-5.4.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-3.1">
              <p id="section-5.4.2-3.1.1">At Step 1 in <a href="#ssec-resp-proc-proxy" class="auto internal xref">Section 5.4</a>, the proxy includes the Reply-From Option in every notification, including non-2.xx notifications resulting in removing the proxy from the list of observers of the origin server.<a href="#section-5.4.2-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.2-3.2">
              <p id="section-5.4.2-3.2.1">The proxy frees up its Token value used for a group observation only if, after the timeout expiration, no 2.xx (Success) responses matching with the group request and also including an Observe Option have been received from any origin server.<a href="#section-5.4.2-3.2.1" class="pilcrow">¶</a></p>
<p id="section-5.4.2-3.2.2">
Otherwise, after the timeout expiration and as long as observations are active with servers in the group for the target resource of the group request, notifications from those servers are forwarded back to the client, as defined in <a href="#ssec-resp-proc-proxy" class="auto internal xref">Section 5.4</a>, and the Token value used for the group observation is not freed during this time.<a href="#section-5.4.2-3.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.4.2-4">Finally, the proxy <span class="bcp14">SHOULD</span> regularly verify that the client is still interested in receiving observe notifications for a group observation. To this end, the proxy can rely on the same approach discussed for servers in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.7" class="relref">Section 3.7</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, with more details available in <span><a href="https://rfc-editor.org/rfc/rfc7641#section-4.5" class="relref">Section 4.5</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>.<a href="#section-5.4.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ssec-resp-proc-client">
<section id="section-5.5">
        <h3 id="name-response-processing-at-the-c">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-response-processing-at-the-c" class="section-name selfRef">Response Processing at the Client</a>
        </h3>
<p id="section-5.5-1">This section defines the operations performed by the client, when receiving a response matching with a request that targeted a group of servers via the proxy.<a href="#section-5.5-1" class="pilcrow">¶</a></p>
<div id="ssec-resp-proc-client-steps">
<section id="section-5.5.1">
          <h4 id="name-response-processing-2">
<a href="#section-5.5.1" class="section-number selfRef">5.5.1. </a><a href="#name-response-processing-2" class="section-name selfRef">Response Processing</a>
          </h4>
<p id="section-5.5.1-1">Upon receiving from the proxy a response matching with the original unicast request before the amount of time T has elapsed (see Step 2 in <a href="#ssec-req-send-steps" class="auto internal xref">Section 5.1.1</a>), the client proceeds according to the following steps.<a href="#section-5.5.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.5.1-2">
<li id="section-5.5.1-2.1">
              <p id="section-5.5.1-2.1.1">The client processes the response as defined in <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>. When doing so, the client decrypts and verifies the response according to the security association that it has with the proxy.<a href="#section-5.5.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.5.1-2.2">
              <p id="section-5.5.1-2.2.1">If secure group communication is used end-to-end between the client and the servers, the client processes the response resulting at the end of Step 1, as defined in <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>.<a href="#section-5.5.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.5.1-2.3">
              <p id="section-5.5.1-2.3.1">The client retrieves the CRI from the value of the Reply-From Option, and identifies the origin server whose addressing information is specified by the CRI. This allows the client to distinguish different responses as generated by different origin servers.<a href="#section-5.5.1-2.3.1" class="pilcrow">¶</a></p>
<p id="section-5.5.1-2.3.2">
Optionally, the client may contact one or more of those servers individually, i.e., directly (bypassing the proxy) or indirectly (via a proxied unicast request). To this end, the client composes the correct URI for the individual request to the origin server, by using the information specified in the CRI retrieved from the Reply-From Option.<a href="#section-5.5.1-2.3.2" class="pilcrow">¶</a></p>
<p id="section-5.5.1-2.3.3">
In order to individually reach the origin server again through the proxy, the client is not required to support the transport protocol indicated by 'scheme' in the CRI and used between the proxy and the origin server, in case the protocol is not CoAP over UDP (CRI scheme number: 0).<a href="#section-5.5.1-2.3.3" class="pilcrow">¶</a></p>
<p id="section-5.5.1-2.3.4">
That is, the client simply specifies the URI for the individual request in the unicast request to the proxy. To this end, the client can specify the URI as a string in the Proxy-Uri Option, or by using the Proxy-Scheme Option together with the Uri-* options. Alternatively, the client can rely on the analogous options defined in <span>[<a href="#I-D.ietf-core-href" class="cite xref">I-D.ietf-core-href</a>]</span>, i.e., on the Proxy-Cri Option conveying a CRI equivalent to the URI, or on the Proxy-Scheme-Number Option together with the Uri-* options. In either case, the client uses the transport protocol that it supports, and has used before, to send the unicast request to the proxy.<a href="#section-5.5.1-2.3.4" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-5.5.1-3">As discussed in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.1.6" class="relref">Section 3.1.6</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, it is possible that the client receives multiple responses to the same group request, i.e., with the same Token, from the same origin server. The specific client implementation determines at which layer deduplication of responses is performed, or whether it is necessary in an application at all. If the processing of a response succeeds, then the client delivers the response to the application as usual. Depending on its available context information, the application itself can be in a good position to decide how to handle such responses.<a href="#section-5.5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.5.1-4">Upon the timeout expiration, i.e., T seconds after having sent the original unicast request to the proxy, the client frees up its local Token value associated with that request. Note that, upon this timeout expiration, the Token value is not eligible for possible reuse yet (see <a href="#ssec-req-send-steps" class="auto internal xref">Section 5.1.1</a>). Thus, until the actual amount of time before enabling Token reusage has elapsed, following late responses to the same request forwarded by the proxy will be discarded, as these are not matching (by Token) with any active request from the client.<a href="#section-5.5.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-resp-proc-client-observe">
<section id="section-5.5.2">
          <h4 id="name-supporting-observe-5">
<a href="#section-5.5.2" class="section-number selfRef">5.5.2. </a><a href="#name-supporting-observe-5" class="section-name selfRef">Supporting Observe</a>
          </h4>
<p id="section-5.5.2-1">When using CoAP Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, the client frees up its Token value only if, after the timeout T expiration, no 2.xx (Success) responses matching with the original unicast request and also including an Observe Option have been received.<a href="#section-5.5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.5.2-2">Instead, if at least one such response has been received, the client continues receiving those notifications as they are forwarded by the proxy, as long as the observation for the target resource of the original unicast request is active.<a href="#section-5.5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-workflow-example">
<section id="section-5.6">
        <h3 id="name-example">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-example" class="section-name selfRef">Example</a>
        </h3>
<p id="section-5.6-1">The example in this section refers to the following actors.<a href="#section-5.6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.6-2.1">
            <p id="section-5.6-2.1.1">One origin client C, with address C_ADDR and port number C_PORT.<a href="#section-5.6-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.6-2.2">
            <p id="section-5.6-2.2.1">One proxy P, with address P_ADDR and port number P_PORT.<a href="#section-5.6-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.6-2.3">
            <p id="section-5.6-2.3.1">Two origin servers S1 and S2, where the server Sx has address Sx_ADDR and port number Sx_PORT.<a href="#section-5.6-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.6-3">The origin servers are members of a CoAP group with IP multicast address G_ADDR and port number G_PORT. Also, the origin servers are members of a same application group, and share the same resource /r.<a href="#section-5.6-3" class="pilcrow">¶</a></p>
<p id="section-5.6-4">The communication between C and P is based on CoAP over UDP, as per <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>. The communication between P and the origin servers is based on CoAP over UDP and IP multicast, as per <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>.<a href="#section-5.6-4" class="pilcrow">¶</a></p>
<p id="section-5.6-5">Finally, cri'X' denotes a CRI corresponding to the URI X.<a href="#section-5.6-5" class="pilcrow">¶</a></p>
<span id="name-workflow-example-with-a-for"></span><div id="workflow-example">
<figure id="figure-1">
          <div id="section-5.6-6.1">
            <div class="alignLeft art-svg artwork" id="section-5.6-6.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="832" width="568" viewBox="0 0 568 832" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,48 L 8,816" fill="none" stroke="black"></path>
                <path d="M 264,48 L 264,768" fill="none" stroke="black"></path>
                <path d="M 448,48 L 448,264" fill="none" stroke="black"></path>
                <path d="M 448,280 L 448,584" fill="none" stroke="black"></path>
                <path d="M 448,632 L 448,816" fill="none" stroke="black"></path>
                <path d="M 560,48 L 560,816" fill="none" stroke="black"></path>
                <path d="M 8,64 L 256,64" fill="none" stroke="black"></path>
                <path d="M 264,240 L 440,240" fill="none" stroke="black"></path>
                <path d="M 408,272 L 552,272" fill="none" stroke="black"></path>
                <path d="M 272,400 L 448,400" fill="none" stroke="black"></path>
                <path d="M 16,480 L 264,480" fill="none" stroke="black"></path>
                <path d="M 272,592 L 560,592" fill="none" stroke="black"></path>
                <path d="M 16,672 L 264,672" fill="none" stroke="black"></path>
                <path d="M 392,240 L 408,272" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="560,272 548,266.4 548,277.6" fill="black" transform="rotate(0,552,272)"></polygon>
                <polygon class="arrowhead" points="448,240 436,234.4 436,245.6" fill="black" transform="rotate(0,440,240)"></polygon>
                <polygon class="arrowhead" points="280,592 268,586.4 268,597.6" fill="black" transform="rotate(180,272,592)"></polygon>
                <polygon class="arrowhead" points="280,400 268,394.4 268,405.6" fill="black" transform="rotate(180,272,400)"></polygon>
                <polygon class="arrowhead" points="264,64 252,58.4 252,69.6" fill="black" transform="rotate(0,256,64)"></polygon>
                <polygon class="arrowhead" points="24,672 12,666.4 12,677.6" fill="black" transform="rotate(180,16,672)"></polygon>
                <polygon class="arrowhead" points="24,480 12,474.4 12,485.6" fill="black" transform="rotate(180,16,480)"></polygon>
                <g class="text">
                  <text x="8" y="36">C</text>
                  <text x="264" y="36">P</text>
                  <text x="452" y="36">S1</text>
                  <text x="556" y="36">S2</text>
                  <text x="36" y="84">Src:</text>
                  <text x="112" y="84">C_ADDR:C_PORT</text>
                  <text x="36" y="100">Dst:</text>
                  <text x="112" y="100">P_ADDR:P_PORT</text>
                  <text x="60" y="116">Proxi-Uri:</text>
                  <text x="132" y="132">"coap://G_ADDR:G_PORT/r"</text>
                  <text x="92" y="148">Multicast-Timeout:</text>
                  <text x="180" y="148">60</text>
                  <text x="292" y="196">Src:</text>
                  <text x="368" y="196">P_ADDR:P_PORT</text>
                  <text x="292" y="212">Dst:</text>
                  <text x="368" y="212">G_ADDR:G_PORT</text>
                  <text x="312" y="228">Uri-Path:</text>
                  <text x="368" y="228">"r"</text>
                  <text x="280" y="324">/</text>
                  <text x="296" y="324">t</text>
                  <text x="312" y="324">=</text>
                  <text x="328" y="324">0</text>
                  <text x="344" y="324">:</text>
                  <text x="360" y="324">P</text>
                  <text x="396" y="324">starts</text>
                  <text x="312" y="340">accepting</text>
                  <text x="392" y="340">responses</text>
                  <text x="288" y="356">for</text>
                  <text x="324" y="356">this</text>
                  <text x="376" y="356">request</text>
                  <text x="416" y="356">/</text>
                  <text x="292" y="420">Src:</text>
                  <text x="372" y="420">S1_ADDR:G_PORT</text>
                  <text x="292" y="436">Dst:</text>
                  <text x="368" y="436">P_ADDR:P_PORT</text>
                  <text x="36" y="500">Src:</text>
                  <text x="112" y="500">P_ADDR:P_PORT</text>
                  <text x="36" y="516">Dst:</text>
                  <text x="112" y="516">C_ADDR:C_PORT</text>
                  <text x="64" y="532">Reply-From:</text>
                  <text x="140" y="548">cri'coap://S1_ADDR:G_PORT'</text>
                  <text x="404" y="612">Src:</text>
                  <text x="488" y="612">S2_ADDR:S2_PORT</text>
                  <text x="404" y="628">Dst:</text>
                  <text x="480" y="628">P_ADDR:P_PORT</text>
                  <text x="36" y="692">Src:</text>
                  <text x="112" y="692">P_ADDR:P_PORT</text>
                  <text x="36" y="708">Dst:</text>
                  <text x="112" y="708">C_ADDR:C_PORT</text>
                  <text x="64" y="724">Reply-From:</text>
                  <text x="144" y="740">cri'coap://S2_ADDR:S2_PORT'</text>
                  <text x="136" y="788">/</text>
                  <text x="156" y="788">At</text>
                  <text x="176" y="788">t</text>
                  <text x="192" y="788">=</text>
                  <text x="216" y="788">60,</text>
                  <text x="240" y="788">P</text>
                  <text x="272" y="788">stops</text>
                  <text x="336" y="788">accepting</text>
                  <text x="168" y="804">responses</text>
                  <text x="224" y="804">for</text>
                  <text x="260" y="804">this</text>
                  <text x="312" y="804">request</text>
                  <text x="352" y="804">/</text>
                  <text x="264" y="820">|</text>
                </g>
              </svg><a href="#section-5.6-6.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-workflow-example-with-a-for" class="selfRef">Workflow Example with a Forward-Proxy</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="sec-reverse-proxies">
<section id="section-6">
      <h2 id="name-reverse-proxies">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-reverse-proxies" class="section-name selfRef">Reverse-Proxies</a>
      </h2>
<p id="section-6-1">The use of reverse-proxies in group communication scenarios is defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.5.2" class="relref">Section 3.5.2</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">This section clarifies how the Multicast-Timeout Option is effective also in such a context, in order for:<a href="#section-6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-3.1">
          <p id="section-6-3.1.1">The proxy to effectively reveal itself as a reverse-proxy to the client.<a href="#section-6-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-3.2">
          <p id="section-6-3.2.1">The client to indicate to the proxy of being aware that it is communicating with a reverse-proxy, and for how long it is willing to receive responses to a proxied group request.<a href="#section-6-3.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-6-4">This practically addresses the additional issues compared to the case with a forward-proxy, as compiled in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.5.2" class="relref">Section 3.5.2</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>.<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5"><a href="#sec-reverse-proxies-examples" class="auto internal xref">Appendix A</a> provides examples with a reverse-proxy.<a href="#section-6-5" class="pilcrow">¶</a></p>
<div id="sec-reverse-proxies-proxy-side">
<section id="section-6.1">
        <h3 id="name-processing-on-the-proxy-sid">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-processing-on-the-proxy-sid" class="section-name selfRef">Processing on the Proxy Side</a>
        </h3>
<p id="section-6.1-1">If the proxy receives a CoAP request and determines that it should be forwarded to a group of servers over IP multicast, then the proxy performs the steps defined in <a href="#ssec-req-proc-proxy" class="auto internal xref">Section 5.2</a>.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">In particular, when such a request does not include a Multicast-Timeout Option, the proxy effectively reveals itself as a reverse-proxy, by replying with a 4.00 (Bad Request) response including a Multicast-Timeout Option with value 0 (which is ultimately represented with an empty option value).<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">The proxy processes the CoAP responses forwarded back to the client as defined in <a href="#ssec-resp-proc-proxy" class="auto internal xref">Section 5.4</a>, with the following additions.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-4.1">
            <p id="section-6.1-4.1.1">As a first possible case, the proxy stands in both for the whole group of servers and for the individual origin servers in the group. That is, the origin client cannot reach the individual servers directly, but only through the proxy.<a href="#section-6.1-4.1.1" class="pilcrow">¶</a></p>
<p id="section-6.1-4.1.2">
In such a case, within a response forwarded back to the client, the value of the Reply-From Option specifies an addressing information TARGET that is directly associated with the proxy. The addressing information is such that, when receiving a unicast request that has been sent according to what is specified in TARGET, the proxy forwards the request to the origin server that generated the response. In particular, the proxy sets the option value as follows.<a href="#section-6.1-4.1.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-4.1.3.1">
                <p id="section-6.1-4.1.3.1.1">The CRI present as first element of the CBOR sequence specifies an addressing information TARGET_1, such that a unicast request reaches the proxy if it is sent according to TARGET_1.<a href="#section-6.1-4.1.3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1-4.1.3.2">
                <p id="section-6.1-4.1.3.2.1">A CRI reference <span class="bcp14">MUST</span> be present as second element of the CBOR sequence in case, upon receiving a unicast request that has been sent according to TARGET_1, the proxy forwards the request based on what is specified by the Uri-Host, Uri-Port, and Uri-Path Options included in the request. The CRI reference specifies the same information that the proxy expects to be specified in the Uri-Host, Uri-Port, and Uri-Path Options of such a unicast request.<a href="#section-6.1-4.1.3.2.1" class="pilcrow">¶</a></p>
<p id="section-6.1-4.1.3.2.2">
Otherwise, the second element of the CBOR sequence <span class="bcp14">MUST NOT</span> be present, in which case the proxy forwards the unicast request solely based on the addressing information TARGET_1 according to which the request has been sent to.<a href="#section-6.1-4.1.3.2.2" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.1-4.1.4">
The client will be able to communicate individually with the origin server that generated the response, by sending a follow-up unicast request to the proxy at the specified addressing information TARGET, according to which the proxy forwards the request to that server. This is further specified in <a href="#sec-reverse-proxies-client-side" class="auto internal xref">Section 6.2</a>. Examples are provided in <a href="#sec-reverse-proxies-examples-ex1" class="auto internal xref">Appendix A.1</a> and <a href="#sec-reverse-proxies-examples-ex2" class="auto internal xref">Appendix A.2</a>.<a href="#section-6.1-4.1.4" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.1-4.2">
            <p id="section-6.1-4.2.1">As a second possible case, the proxy stands in only for the whole group of servers, but not for the individual servers in the group. That is, the origin client can reach the individual servers directly, without recourse to the proxy.<a href="#section-6.1-4.2.1" class="pilcrow">¶</a></p>
<p id="section-6.1-4.2.2">
In such a case, within a response forwarded back to the client, the value of the Reply-From Option specifies an addressing information TARGET that is directly associated with the origin server that generated the response. In particular, the proxy sets the option value as follows.
 * The CRI present as first element of the CBOR sequence specifies the addressing information TARGET, such that a unicast request reaches the origin server if sent according to TARGET. The second element of the CBOR sequence <span class="bcp14">MUST NOT</span> be present.<a href="#section-6.1-4.2.2" class="pilcrow">¶</a></p>
<p id="section-6.1-4.2.3">
The client will be able to use that information for sending a follow-up unicast request directly to that server, i.e., bypassing the proxy. This is further specified in <a href="#sec-reverse-proxies-client-side" class="auto internal xref">Section 6.2</a>. An example is provided in <a href="#sec-reverse-proxies-examples-ex3" class="auto internal xref">Appendix A.3</a>.<a href="#section-6.1-4.2.3" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-reverse-proxies-client-side">
<section id="section-6.2">
        <h3 id="name-processing-on-the-client-si">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-processing-on-the-client-si" class="section-name selfRef">Processing on the Client Side</a>
        </h3>
<p id="section-6.2-1">If a client sends a CoAP request intended to a group of servers and is aware of actually communicating with a reverse-proxy, then the client <span class="bcp14">MUST</span> perform the steps defined in <a href="#ssec-req-send-steps" class="auto internal xref">Section 5.1.1</a>. In particular, this results in a request sent to the proxy including a Multicast-Timeout Option.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">The client processes the CoAP responses forwarded back by the proxy as defined in <a href="#ssec-resp-proc-client" class="auto internal xref">Section 5.5</a>, with the following differences at Step 3.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-3.1">
            <p id="section-6.2-3.1.1">If the client wishes to send a follow-up unicast request intended only to the origin server that generated the response, then the client sends such a request according to the addressing information specified by the CRI retrieved from the value of the Reply-From Option.<a href="#section-6.2-3.1.1" class="pilcrow">¶</a></p>
<p id="section-6.2-3.1.2">
Effectively, the client sends the unicast request either directly to the origin server (in case the proxy stands in only for the whole group of servers, but not for the individual servers in the group), or to the proxy (in case the proxy stands in for both the whole group of servers and the individual servers in the group).<a href="#section-6.2-3.1.2" class="pilcrow">¶</a></p>
<p id="section-6.2-3.1.3">
In case the value of the Reply-From Option specifies also a CRI reference as second element of the CBOR sequence, then the client includes the Uri-Host, Uri-Port, and Uri-Path Options in the unicast request, according to what is specified by the corresponding elements of the CRI reference. If the client wants to specify additional path segments that identify a specific resource at the origin server, then the corresponding Uri-Path Options are included in the request after the Uri-Path Options corresponding to the path component of the CRI reference.<a href="#section-6.2-3.1.3" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-proxy-caching">
<section id="section-7">
      <h2 id="name-caching">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-caching" class="section-name selfRef">Caching</a>
      </h2>
<p id="section-7-1">A proxy <span class="bcp14">MAY</span> cache responses to a group request, as defined in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.7.1" class="relref">Section 5.7.1</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>. In particular, the same rules apply to determine the set of request options used as "Cache-Key" and to determine the max-age values offered for responses served from the cache.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">A cache entry is associated with one server and stores one response from that server, regardless of whether it is a response to a unicast request or to a group request. The following two types of requests can produce a hit to a cache entry.<a href="#section-7-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-3.1">
          <p id="section-7-3.1.1">A matching request intended to that server, i.e., to the corresponding unicast URI.<a href="#section-7-3.1.1" class="pilcrow">¶</a></p>
<p id="section-7-3.1.2">
When the stored response is a response to a unicast request to the server, the unicast URI of the matching request is the same target URI used for the original unicast request.<a href="#section-7-3.1.2" class="pilcrow">¶</a></p>
<p id="section-7-3.1.3">
When the stored response is a response to a group request to the CoAP group, the unicast URI of the matching request is the target URI obtained by replacing the authority component of the group URI in the original group request with the transport-layer source address and port number of the response.<a href="#section-7-3.1.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.2">
          <p id="section-7-3.2.1">A matching group request intended to the CoAP group, i.e., to the corresponding group URI.<a href="#section-7-3.2.1" class="pilcrow">¶</a></p>
<p id="section-7-3.2.2">
That is, a matching group request produces a hit to multiple cache entries, each of which associated with one of the CoAP servers currently member of the CoAP group.<a href="#section-7-3.2.2" class="pilcrow">¶</a></p>
<p id="section-7-3.2.3">
Note that, as per the freshness model defined in <a href="#sec-proxy-caching-freshness" class="auto internal xref">Section 7.1</a>, the proxy might serve a group request exclusively from its cached responses only when it knows all the CoAP servers that are current members of the CoAP group and it has a valid cache entry for each of them.<a href="#section-7-3.2.3" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-7-4">When forwarding a GET or FETCH group request to the servers in the CoAP group, the proxy behaves like a CoAP client as defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, with the following additions.<a href="#section-7-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-5.1">
          <p id="section-7-5.1.1">As discussed in <a href="#ssec-resp-proc-proxy-steps" class="auto internal xref">Section 5.4.1</a>, the proxy can receive multiple responses to the same group request from a same origin server, and forwards them back to the origin client "as they come". When this happens, each of such multiple responses is stored in the cache entry associated with the server "as it comes", possibly replacing an already stored response from that server.<a href="#section-7-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-5.2">
          <p id="section-7-5.2.1">As discussed in <a href="#sec-group-caching" class="auto internal xref">Section 7.4</a>, when communications in the group are secured with Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>, additional means are required to enable cacheability of responses at the proxy.<a href="#section-7-5.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-7-6">The following subsections define the freshness model and validation model that the proxy uses for cached responses.<a href="#section-7-6" class="pilcrow">¶</a></p>
<div id="sec-proxy-caching-freshness">
<section id="section-7.1">
        <h3 id="name-freshness-model">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-freshness-model" class="section-name selfRef">Freshness Model</a>
        </h3>
<p id="section-7.1-1">The proxy relies on the same freshness model defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.2.1" class="relref">Section 3.2.1</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, by taking the role of a CoAP client with respect to the servers in the CoAP group.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">In particular, when receiving a unicast group request from the client, the proxy <span class="bcp14">MAY</span> serve it by using exclusively cached responses without forwarding the group request to the servers in the CoAP group, but only if both the following conditions hold.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-3.1">
            <p id="section-7.1-3.1.1">The proxy knows all the CoAP servers that are currently members of the CoAP group for which the group request is intended to.<a href="#section-7.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.1-3.2">
            <p id="section-7.1-3.2.1">The proxy's cache currently stores a fresh response for each of those CoAP servers.<a href="#section-7.1-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-7.1-4">The specific way that the proxy uses to determine the CoAP servers currently members of the target CoAP group is out of scope for this document. As possible examples, the proxy can synchronize with a group manager server; rely on well-known time patterns used by the application or in the network for the addition of new CoAP group members; observe group join requests or IGMP/MLD multicast group join messages, e.g., if embedded in a multicast router.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<p id="section-7.1-5">When forwarding the group request to the servers, the proxy may have fresh responses stored in its cache for (some of) those servers. In such a case, the proxy uses (also) those cached responses to serve the original unicast group request, as defined below.<a href="#section-7.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-6.1">
            <p id="section-7.1-6.1.1">The request processing in <a href="#ssec-req-proc-proxy-steps" class="auto internal xref">Section 5.2.1</a> is extended as follows.<a href="#section-7.1-6.1.1" class="pilcrow">¶</a></p>
<p id="section-7.1-6.1.2">
After setting the timeout with value T' &gt; 0 in Step 6, the proxy checks whether its cache currently stores fresh responses to the group request. For each of such responses, the proxy compares the residual lifetime L of the corresponding cache entry against the value T'.<a href="#section-7.1-6.1.2" class="pilcrow">¶</a></p>
<p id="section-7.1-6.1.3">
If a cached response X is such that L &lt; T', then the proxy forwards X back to the client at its earliest convenience. Otherwise, the proxy does not forward X back to the client right away, and rather waits for approaching the timeout expiration, as discussed in the next point.<a href="#section-7.1-6.1.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.1-6.2">
            <p id="section-7.1-6.2.1">The response processing in <a href="#ssec-resp-proc-proxy-steps" class="auto internal xref">Section 5.4.1</a> is extended as follows.<a href="#section-7.1-6.2.1" class="pilcrow">¶</a></p>
<p id="section-7.1-6.2.2">
Before the timeout with original value T' &gt; 0 expires and the proxy stops accepting responses to the group request, the proxy checks whether it stores in its cache any fresh response X to the group request such that both the following conditions hold.<a href="#section-7.1-6.2.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-6.2.3.1">
                <p id="section-7.1-6.2.3.1.1">The cache entry E storing X was already existing when the proxy forwarded the group request.<a href="#section-7.1-6.2.3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-7.1-6.2.3.2">
                <p id="section-7.1-6.2.3.2.1">The proxy has received no response to the forwarded group request from the server associated with E.<a href="#section-7.1-6.2.3.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-7.1-6.2.4">
Then, the proxy sends back to the client each response X stored in its cache and selected as above, before the timeout expires.<a href="#section-7.1-6.2.4" class="pilcrow">¶</a></p>
<p id="section-7.1-6.2.5">
Note that, from the forwarding of the group request until the timeout expiration, the proxy still forwards responses to the group request back to the client "as they come" (see <a href="#ssec-resp-proc-proxy-steps" class="auto internal xref">Section 5.4.1</a>). Also, such responses possibly refresh older responses from the same servers that the proxy has stored in its cache, as defined earlier in <a href="#sec-proxy-caching" class="auto internal xref">Section 7</a>.<a href="#section-7.1-6.2.5" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-proxy-caching-validation">
<section id="section-7.2">
        <h3 id="name-validation-model">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-validation-model" class="section-name selfRef">Validation Model</a>
        </h3>
<p id="section-7.2-1">This section defines the revalidation of responses, separately between the proxy and the origin servers, as well as between the origin client and the proxy.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<div id="sec-proxy-caching-validation-p-s-unicast">
<section id="section-7.2.1">
          <h4 id="name-proxy-servers-revalidation-">
<a href="#section-7.2.1" class="section-number selfRef">7.2.1. </a><a href="#name-proxy-servers-revalidation-" class="section-name selfRef">Proxy-Servers Revalidation with Unicast Requests</a>
          </h4>
<p id="section-7.2.1-1">The proxy <span class="bcp14">MAY</span> revalidate a cached response by making a GET or FETCH request on the related unicast request URI, i.e., by taking the role of a CoAP client with respect to a server in the CoAP group.<a href="#section-7.2.1-1" class="pilcrow">¶</a></p>
<p id="section-7.2.1-2">As discussed in <a href="#sec-group-caching" class="auto internal xref">Section 7.4</a>, this is however not possible for the proxy if communications in the group are secured end-to-end between origin client and origin servers by using Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>.<a href="#section-7.2.1-2" class="pilcrow">¶</a></p>
<p id="section-7.2.1-3">[ TODO<a href="#section-7.2.1-3" class="pilcrow">¶</a></p>
<p id="section-7.2.1-4">It can be actually possible to enable revalidation of responses between proxy and server, also in this case where Group OSCORE is used end-to-end between client and origin servers.<a href="#section-7.2.1-4" class="pilcrow">¶</a></p>
<p id="section-7.2.1-5">Fundamentally, this requires to define the possible use of the ETag Option also as an outer option for OSCORE. Thus, in addition to the normal inner ETag, a server can add also an outer ETag option intended to the proxy.<a href="#section-7.2.1-5" class="pilcrow">¶</a></p>
<p id="section-7.2.1-6">Since validation of responses assumes that cacheability of responses is possible in the first place, it would be convenient to define the use of ETag as outer option in <span>[<a href="#I-D.amsuess-core-cachable-oscore" class="cite xref">I-D.amsuess-core-cachable-oscore</a>]</span>.<a href="#section-7.2.1-6" class="pilcrow">¶</a></p>
<p id="section-7.2.1-7">In case OSCORE is also used between the proxy and an individual origin server as per <span>[<a href="#I-D.ietf-core-oscore-capable-proxies" class="cite xref">I-D.ietf-core-oscore-capable-proxies</a>]</span>, then the outer ETag Option would be seamlessly protected with the OSCORE Security Context shared between the proxy and the origin server.<a href="#section-7.2.1-7" class="pilcrow">¶</a></p>
<p id="section-7.2.1-8">The following text can be used to replace the last paragraph above.<a href="#section-7.2.1-8" class="pilcrow">¶</a></p>
<p id="section-7.2.1-9"></p>
<p id="section-7.2.1-10">As discussed in <a href="#sec-group-caching" class="auto internal xref">Section 7.4</a>, the following applies when Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span> is used to secure communications end-to-end between the origin client and the origin servers in the group.<a href="#section-7.2.1-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.1-11.1">
              <p id="section-7.2.1-11.1.1">Additional means are required to enable cacheability of responses at the proxy (see <a href="#sec-det-req" class="auto internal xref">Section 7.4.1</a>).<a href="#section-7.2.1-11.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.1-11.2">
              <p id="section-7.2.1-11.2.1">If a cached response included an outer ETag Option intended to the proxy, then the proxy can perform revalidation of the cached response, by making a request to the unicast URI targeting the server, and including outer ETag Option(s).<a href="#section-7.2.1-11.2.1" class="pilcrow">¶</a></p>
<p id="section-7.2.1-11.2.2">
This is possible also in case the proxy and the origin server use OSCORE to further protect the exchanged request and response, as defined in <span>[<a href="#I-D.ietf-core-oscore-capable-proxies" class="cite xref">I-D.ietf-core-oscore-capable-proxies</a>]</span>. In such a case, the originally outer ETag Option is protected with the OSCORE Security Context shared between the proxy and the origin server, before transferring the message over the communication leg between the proxy and origin server.<a href="#section-7.2.1-11.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.2.1-12">]<a href="#section-7.2.1-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-proxy-caching-validation-p-s">
<section id="section-7.2.2">
          <h4 id="name-proxy-servers-revalidation-w">
<a href="#section-7.2.2" class="section-number selfRef">7.2.2. </a><a href="#name-proxy-servers-revalidation-w" class="section-name selfRef">Proxy-Servers Revalidation with Group Requests</a>
          </h4>
<p id="section-7.2.2-1">When forwarding a group request to the servers in the CoAP group, the proxy <span class="bcp14">MAY</span> revalidate one or more stored responses that it has cached.<a href="#section-7.2.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2.2-2">To this end, the proxy relies on the same validation model defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.2.2" class="relref">Section 3.2.2</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span> and using the ETag Option, by taking the role of a CoAP client with respect to the servers in the CoAP group.<a href="#section-7.2.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2.2-3">As discussed in <a href="#sec-group-caching" class="auto internal xref">Section 7.4</a>, this is however not possible for the proxy if communications in the group are secured end-to-end between origin client and origin servers by using Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>.<a href="#section-7.2.2-3" class="pilcrow">¶</a></p>
<p id="section-7.2.2-4">[ TODO<a href="#section-7.2.2-4" class="pilcrow">¶</a></p>
<p id="section-7.2.2-5">See the notes in <a href="#sec-proxy-caching-validation-p-s-unicast" class="auto internal xref">Section 7.2.1</a>.<a href="#section-7.2.2-5" class="pilcrow">¶</a></p>
<p id="section-7.2.2-6">The following text can be used to replace the last paragraph above.<a href="#section-7.2.2-6" class="pilcrow">¶</a></p>
<p id="section-7.2.2-7"></p>
<p id="section-7.2.2-8">As discussed in <a href="#sec-group-caching" class="auto internal xref">Section 7.4</a>, the following applies when Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span> is used to secure communications end-to-end between the origin client and the origin servers in the group.<a href="#section-7.2.2-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.2-9.1">
              <p id="section-7.2.2-9.1.1">Additional means are required to enable cacheability of responses at the proxy (see <a href="#sec-det-req" class="auto internal xref">Section 7.4.1</a>).<a href="#section-7.2.2-9.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.2-9.2">
              <p id="section-7.2.2-9.2.1">If a cached response included an outer ETag Option intended to the proxy, then the proxy can perform revalidation of the cached response, by making a request to the group URI targeting the CoAP group, and including outer ETag Option(s).<a href="#section-7.2.2-9.2.1" class="pilcrow">¶</a></p>
<p id="section-7.2.2-9.2.2">
This is possible also in case the proxy and the origin servers use Group OSCORE to further protect the exchanged request and response, as defined in <span>[<a href="#I-D.ietf-core-oscore-capable-proxies" class="cite xref">I-D.ietf-core-oscore-capable-proxies</a>]</span>. In such a case, the originally outer ETag Option is protected with the Group OSCORE Security Context shared between the proxy and the origin server, before transferring the message over the communication leg between the proxy and origin server.<a href="#section-7.2.2-9.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.2.2-10">]<a href="#section-7.2.2-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-proxy-caching-validation-c-p">
<section id="section-7.3">
        <h3 id="name-client-proxy-revalidation-w">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-client-proxy-revalidation-w" class="section-name selfRef">Client-Proxy Revalidation with Group Requests</a>
        </h3>
<p id="section-7.3-1">A client <span class="bcp14">MAY</span> revalidate the full set of responses to a group request by leveraging the corresponding cache entries at the proxy. To this end, this document defines the new Group-ETag Option.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">The Group-ETag Option has the properties summarized in <a href="#_table-response-group-etag-option" class="auto internal xref">Table 3</a>, which extends Table 4 of <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>. The Group-ETag Option is elective, safe to forward, part of the cache key, and repeatable.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
<p id="section-7.3-3">The option is intended for group requests sent to a proxy to be forwarded to the servers in a CoAP group, as well as for the associated responses.<a href="#section-7.3-3" class="pilcrow">¶</a></p>
<span id="name-the-group-etag-option-ccrit"></span><div id="_table-response-group-etag-option">
<table class="center" id="table-3">
          <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-the-group-etag-option-ccrit" class="selfRef">The Group-ETag Option. C=Critical, U=Unsafe, N=NoCacheKey, R=Repeatable</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">No.</th>
              <th class="text-left" rowspan="1" colspan="1">C</th>
              <th class="text-left" rowspan="1" colspan="1">U</th>
              <th class="text-left" rowspan="1" colspan="1">N</th>
              <th class="text-left" rowspan="1" colspan="1">R</th>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Format</th>
              <th class="text-left" rowspan="1" colspan="1">Length</th>
              <th class="text-left" rowspan="1" colspan="1">Default</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">TBD3</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">x</td>
              <td class="text-left" rowspan="1" colspan="1">Group-ETag</td>
              <td class="text-left" rowspan="1" colspan="1">opaque</td>
              <td class="text-left" rowspan="1" colspan="1">1-8</td>
              <td class="text-left" rowspan="1" colspan="1">(none)</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-7.3-5">The Group-ETag Option has the same properties of the ETag Option defined in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.10.6" class="relref">Section 5.10.6</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>.<a href="#section-7.3-5" class="pilcrow">¶</a></p>
<p id="section-7.3-6">The Group-ETag Option is of class U in terms of OSCORE processing (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-4.1" class="relref">Section 4.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>).<a href="#section-7.3-6" class="pilcrow">¶</a></p>
<p id="section-7.3-7">A proxy <span class="bcp14">MUST NOT</span> provide this form of validation if it is not in a position to serve a group request by using exclusively cached responses, i.e., without sending the group request to the servers in the CoAP group (see <a href="#sec-proxy-caching-freshness" class="auto internal xref">Section 7.1</a>).<a href="#section-7.3-7" class="pilcrow">¶</a></p>
<p id="section-7.3-8">If the proxy supports this form of response revalidation, the following applies.<a href="#section-7.3-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3-9.1">
            <p id="section-7.3-9.1.1">The proxy defines J as a joint set including all the cache entries currently storing fresh responses that satisfy a group request. A set J is "complete" if it includes a valid cache entry for each of the CoAP servers currently members of the CoAP group.<a href="#section-7.3-9.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.3-9.2">
            <p id="section-7.3-9.2.1">When the set J becomes "complete", the proxy assigns it an entity-tag value. The proxy <span class="bcp14">MUST</span> update the current entity-tag value, when J is "complete" and one of its cache entry is updated.<a href="#section-7.3-9.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.3-9.3">
            <p id="section-7.3-9.3.1">When forwarding to the client a 2.05 (Content) response to a GET or FETCH group request, the proxy <span class="bcp14">MAY</span> include one Group-ETag Option, in case the set J is "complete". Such a response <span class="bcp14">MUST NOT</span> include more than one Group-ETag Option. The option value specifies the entity-tag value currently associated with the set J.<a href="#section-7.3-9.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-7.3-10">When sending to the proxy a GET or FETCH request to be forwarded to the servers in the CoAP group, the client <span class="bcp14">MAY</span> include one or more Group-ETag Options. Each option specifies one entity-tag value, applicable to the set J of cache entries that can be hit by the group request.<a href="#section-7.3-10" class="pilcrow">¶</a></p>
<p id="section-7.3-11">The proxy <span class="bcp14">MAY</span> perform the following actions, in case the group request produces a hit to the cache entry of each CoAP server currently member of the CoAP group, i.e., in case the set J associated with the group request is "complete".<a href="#section-7.3-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3-12.1">
            <p id="section-7.3-12.1.1">The proxy checks whether the current entity-tag value of the set J matches with one of the entity-tag values specified in the Group-ETag Options of the unicast group request from the client.<a href="#section-7.3-12.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.3-12.2">
            <p id="section-7.3-12.2.1">In case of positive match, the proxy replies with a single 2.03 (Valid) response. This response has no payload and <span class="bcp14">MUST</span> include one Group-ETag Option, specifying the current entity-tag value of the set J.<a href="#section-7.3-12.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-7.3-13">That is, the 2.03 (Valid) response from the proxy indicates to the client that the stored responses identified by the entity-tag given in the response's Group-ETag Option can be reused, after updating each of them as described in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.9.1.3" class="relref">Section 5.9.1.3</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>. In effect, the client can determine if any of the stored representations from the respective cache entries at the proxy is current, without needing to transfer any of them again.<a href="#section-7.3-13" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-group-caching">
<section id="section-7.4">
        <h3 id="name-caching-of-end-to-end-prote">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-caching-of-end-to-end-prote" class="section-name selfRef">Caching of End-To-End Protected Responses at Proxies</a>
        </h3>
<p id="section-7.4-1">When using Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span> to protect communications end-to-end between a client and multiple servers in the group, it is normally not possible for an intermediary proxy to effectively cache protected responses.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<p id="section-7.4-2">In fact, when starting from the same plain CoAP message, different clients generate different protected requests to send on the wire. This prevents different clients to generate potential cache hits, and thus makes response caching at the proxy pointless.<a href="#section-7.4-2" class="pilcrow">¶</a></p>
<div id="sec-det-req">
<section id="section-7.4.1">
          <h4 id="name-deterministic-requests-to-a">
<a href="#section-7.4.1" class="section-number selfRef">7.4.1. </a><a href="#name-deterministic-requests-to-a" class="section-name selfRef">Deterministic Requests to Achieve Cacheability</a>
          </h4>
<p id="section-7.4.1-1">For application scenarios that use secure group communication, it is still possible to achieve cacheability of responses at proxies by using the approach defined in <span>[<a href="#I-D.amsuess-core-cachable-oscore" class="cite xref">I-D.amsuess-core-cachable-oscore</a>]</span>, which is based on Deterministic Requests protected with the pairwise mode of Group OSCORE. This approach is limited to group requests that are safe (in the RESTful sense) to process and do not yield side effects at the servers. As for any protected group request, it requires the clients and all the servers in the CoAP group to have already joined the correct OSCORE group.<a href="#section-7.4.1-1" class="pilcrow">¶</a></p>
<p id="section-7.4.1-2">Starting from the same plain CoAP request, this allows different clients in the OSCORE group to deterministically generate a same request protected with Group OSCORE, which is sent to the proxy for being forwarded to the CoAP group. The proxy can now effectively cache the resulting responses from the servers in the CoAP group, since the same plain CoAP request will result again in the same Deterministic Request and thus will produce a cache hit.<a href="#section-7.4.1-2" class="pilcrow">¶</a></p>
<p id="section-7.4.1-3">When caching of Group OSCORE secured responses is enabled at the proxy, the same as defined in <a href="#sec-proxy-caching" class="auto internal xref">Section 7</a> applies, with respect to cache entries and their lifetimes.<a href="#section-7.4.1-3" class="pilcrow">¶</a></p>
<p id="section-7.4.1-4">Note that different Deterministic Requests result in different cache entries at the proxy. This includes the case where different plain group requests differ only in their set of ETag Options, as defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.2.2" class="relref">Section 3.2.2</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>.<a href="#section-7.4.1-4" class="pilcrow">¶</a></p>
<p id="section-7.4.1-5">That is, even though the servers would produce the same plain CoAP responses when replying to two different Deterministic Requests, those will result in different protected responses to each respective Deterministic Request, hence in different cache entries at the proxy.<a href="#section-7.4.1-5" class="pilcrow">¶</a></p>
<p id="section-7.4.1-6">Thus, given a plain group request, a client needs to reuse the same set of ETag Options, in order to send that group request as a Deterministic Request that can actually produce a cache hit at the proxy. However, while this would prevent the caching at the proxy from being inefficient and unnecessarily redundant, it would also limit the flexibility of end-to-end response revalidation for a client.<a href="#section-7.4.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="chap-sec-group-caching-validation">
<section id="section-7.4.2">
          <h4 id="name-validation-of-responses">
<a href="#section-7.4.2" class="section-number selfRef">7.4.2. </a><a href="#name-validation-of-responses" class="section-name selfRef">Validation of Responses</a>
          </h4>
<p id="section-7.4.2-1">Response revalidation remains possible end-to-end between the client and the servers in the group, by including inner ETag Options as defined in Sections <a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.2" class="relref">3.2</a> and <a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.2.2" class="relref">3.2.2</a> of <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>.<a href="#section-7.4.2-1" class="pilcrow">¶</a></p>
<p id="section-7.4.2-2">Furthermore, it remains possible for a client to attempt revalidating responses to a group request from a "complete" set of cache entries at the proxy, by using the Group-ETag Option as defined in <a href="#sec-proxy-caching-validation-c-p" class="auto internal xref">Section 7.3</a>.<a href="#section-7.4.2-2" class="pilcrow">¶</a></p>
<p id="section-7.4.2-3">When directly interacting with the servers in the CoAP group to refresh its cache entries, the proxy cannot rely on response revalidation anymore. This applies to both the case where the request is addressed to a single server and sent to the related unicast URI (see <a href="#sec-proxy-caching-validation-p-s-unicast" class="auto internal xref">Section 7.2.1</a>) or instead is a group request addressed to the CoAP group and sent to the related group URI (see <a href="#sec-proxy-caching-validation-p-s" class="auto internal xref">Section 7.2.2</a>).<a href="#section-7.4.2-3" class="pilcrow">¶</a></p>
<p id="section-7.4.2-4">[ TODO<a href="#section-7.4.2-4" class="pilcrow">¶</a></p>
<p id="section-7.4.2-5">See the notes in <a href="#sec-proxy-caching-validation-p-s-unicast" class="auto internal xref">Section 7.2.1</a>.<a href="#section-7.4.2-5" class="pilcrow">¶</a></p>
<p id="section-7.4.2-6">The following text can be used to replace the last paragraph above.<a href="#section-7.4.2-6" class="pilcrow">¶</a></p>
<p id="section-7.4.2-7"></p>
<p id="section-7.4.2-8">When directly interacting with the servers in the CoAP group to refresh its cache entries, the proxy also remains able to perform response revalidation. That is, if a cached response included an outer ETag Option intended to the proxy, then the proxy can perform revalidation of the cached response, by making a request to the unicast URI addressed to a single server and sent to the related unicast URI (see <a href="#sec-proxy-caching-validation-p-s-unicast" class="auto internal xref">Section 7.2.1</a>) or a group request addressed to the CoAP group and sent to the related group URI (see <a href="#sec-proxy-caching-validation-p-s" class="auto internal xref">Section 7.2.2</a>).<a href="#section-7.4.2-8" class="pilcrow">¶</a></p>
<p id="section-7.4.2-9">]<a href="#section-7.4.2-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-proxy-chain">
<section id="section-8">
      <h2 id="name-chain-of-proxies">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-chain-of-proxies" class="section-name selfRef">Chain of Proxies</a>
      </h2>
<p id="section-8-1">A client may be interested to access a resource at a group of origin servers that is reached through a chain of two or more proxies.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">That is, these proxies are configured into a chain, where each non-last proxy is configured to forward (group) requests to the next hop towards the origin servers. Also, each non-first proxy is configured to forward back responses to the previous hop proxy towards the origin client.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">This section specifies how the signaling protocol defined in <a href="#sec-description" class="auto internal xref">Section 5</a> is used in that setting. Except for the last proxy before the origin servers, every other proxy in the chain takes the role of client with respect to the next hop towards the origin servers. Also, every proxy in the chain except the first takes the role of server towards the previous proxy closer to the origin client.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">Accordingly, possible caching of responses at each proxy works as defined in <a href="#sec-proxy-caching" class="auto internal xref">Section 7</a> and <a href="#sec-group-caching" class="auto internal xref">Section 7.4</a>. Also, possible revalidation of responses cached at each proxy and based on the Group-ETag Option works as defined in <a href="#sec-proxy-caching-validation-c-p" class="auto internal xref">Section 7.3</a> and <a href="#chap-sec-group-caching-validation" class="auto internal xref">Section 7.4.2</a>.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">The requirements REQ1 and REQ2 defined in <a href="#sec-objectives" class="auto internal xref">Section 4</a> <span class="bcp14">MUST</span> be fulfilled for each proxy in the chain. That is, every proxy in the chain has to be explicitly configured with an allow-list that allows proxied group requests from specific senders, and <span class="bcp14">MUST</span> identify those senders upon receiving their group request. For the first proxy in the chain, that sender is the origin client. For each other proxy in the chain, that sender is the previous hop proxy closer to the origin client. In either case, a proxy can identify the sender of a group request by the same means mentioned in <a href="#sec-objectives" class="auto internal xref">Section 4</a>.<a href="#section-8-5" class="pilcrow">¶</a></p>
<div id="sec-proxy-chain-request-processing">
<section id="section-8.1">
        <h3 id="name-request-processing-at-the-pr">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-request-processing-at-the-pr" class="section-name selfRef">Request Processing at the Proxy</a>
        </h3>
<p id="section-8.1-1">Upon receiving a group request to be forwarded to a CoAP group URI, a proxy proceeds as follows.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">If the proxy is the last one in the chain, i.e., it is the last hop before the origin servers, the proxy performs the steps defined in <a href="#ssec-req-proc-proxy" class="auto internal xref">Section 5.2</a>, with no modifications.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">Otherwise, the proxy performs the steps defined in <a href="#ssec-req-proc-proxy" class="auto internal xref">Section 5.2</a>, with the following differences.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-4.1">
            <p id="section-8.1-4.1.1">At Steps 1-3, "client" refers to the origin client when the proxy is the first one in the chain, or to the previous hop proxy closer to the origin client otherwise.<a href="#section-8.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-4.2">
            <p id="section-8.1-4.2.1">At Step 4, the proxy rather performs the following actions.<a href="#section-8.1-4.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8.1-4.2.2">
<li id="section-8.1-4.2.2.1">
                <p id="section-8.1-4.2.2.1.1">The proxy retrieves the value T' from the Multicast-Timeout Option, and does not remove the option.<a href="#section-8.1-4.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-8.1-4.2.2.2">
                <p id="section-8.1-4.2.2.2.1">In case T' &gt; 0, the proxy picks an amount of time T that it is fine to wait for before freeing up its local Token value to use with the next hop towards the origin servers. To this end, the proxy <span class="bcp14">MUST</span> follow what is defined at Step 2 of <a href="#ssec-req-send-steps" class="auto internal xref">Section 5.1.1</a> for the origin client, with the following differences.<a href="#section-8.1-4.2.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-4.2.2.2.2.1">
                    <p id="section-8.1-4.2.2.2.2.1.1">T <span class="bcp14">MUST</span> be greater than the retrieved value T', i.e., T' &lt; T.<a href="#section-8.1-4.2.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-8.1-4.2.2.2.2.2">
                    <p id="section-8.1-4.2.2.2.2.2.1">The worst-case message processing time takes into account all the next hops towards the origin servers, as well as the origin servers themselves.<a href="#section-8.1-4.2.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-8.1-4.2.2.2.2.3">
                    <p id="section-8.1-4.2.2.2.2.3.1">The worst-case round-trip delay takes into account all the legs between the proxy and the origin servers.<a href="#section-8.1-4.2.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li id="section-8.1-4.2.2.3">
                <p id="section-8.1-4.2.2.3.1">In case T' &gt; 0, the proxy replaces the value of the Multicast-Timeout Option with a new value T'', such that:<a href="#section-8.1-4.2.2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-4.2.2.3.2.1">
                    <p id="section-8.1-4.2.2.3.2.1.1">T'' &lt; T. The difference (T - T'') should be at least the expected worst-case round-trip time between the proxy and the next hop towards the origin servers.<a href="#section-8.1-4.2.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-8.1-4.2.2.3.2.2">
                    <p id="section-8.1-4.2.2.3.2.2.1">T'' &lt; T'. The difference (T' - T'') should be at least the expected worst-case round-trip time between the proxy and the (previous hop proxy closer to the) origin client.<a href="#section-8.1-4.2.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
<p id="section-8.1-4.2.2.3.3">
If the proxy is not able to determine a value T'' that fulfills both the requirements above, the proxy <span class="bcp14">MUST</span> stop processing the request and <span class="bcp14">MUST</span> respond with a 5.05 (Proxying Not Supported) error response to the (previous hop proxy closer to the) origin client. The proxy <span class="bcp14">SHOULD</span> include a Multicast-Timeout Option, set to the minimum value T' that would be acceptable in the Multicast-Timeout Option of a group request to forward.<a href="#section-8.1-4.2.2.3.3" class="pilcrow">¶</a></p>
<p id="section-8.1-4.2.2.3.4">
If the proxy is the first one in the chain, then the error response is sent to the origin client. Upon receiving the error response, the origin client <span class="bcp14">MAY</span> send an updated group request to the same first proxy in the chain. In the updated request, the Multicast-Timeout Option <span class="bcp14">SHOULD</span> specify a value T' such that: it is greater than the one specified in the original group request; and it is greater than or equal to the one specified in the error response (if present therein).<a href="#section-8.1-4.2.2.3.4" class="pilcrow">¶</a></p>
<p id="section-8.1-4.2.2.3.5">
Otherwise, upon receiving the error response, any other proxy in the chain <span class="bcp14">MAY</span> send an updated group request to the next hop towards the origin servers. In the updated group request, the Multicast-Timeout Option <span class="bcp14">MUST</span> specify a value T' such that: it is greater than the one specified in the previous forwarded request; and it is greater than or equal to the one specified in the error response (if present therein). If the proxy does not send an updated group request, the proxy <span class="bcp14">MUST</span> also send a 5.05 (Proxying Not Supported) error response to the previous hop proxy closer to the origin client. Like the received one, also this error response <span class="bcp14">SHOULD</span> include a Multicast-Timeout Option, set to the minimum value T' acceptable by the proxy sending the error response.<a href="#section-8.1-4.2.2.3.5" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
          <li class="normal" id="section-8.1-4.3">
            <p id="section-8.1-4.3.1">At Step 5, the proxy forwards the request to the next hop towards the origin servers.<a href="#section-8.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-4.4">
            <p id="section-8.1-4.4.1">At Step 6, the proxy sets a timeout with the value T' retrieved from the
Multicast-Timeout Option of the request received from the (previous hop proxy closer to the) origin client.<a href="#section-8.1-4.4.1" class="pilcrow">¶</a></p>
<p id="section-8.1-4.4.2">
In case T' &gt; 0, the proxy will ignore responses to the forwarded group request coming from the next hop towards the origin servers, if received after the timeout expiration, with the exception of Observe notifications (see <a href="#ssec-resp-proc-proxy" class="auto internal xref">Section 5.4</a>).<a href="#section-8.1-4.4.2" class="pilcrow">¶</a></p>
<p id="section-8.1-4.4.3">
In case T' = 0, the proxy will ignore all responses to the forwarded group request coming from the next hop towards the origin servers.<a href="#section-8.1-4.4.3" class="pilcrow">¶</a></p>
</li>
        </ul>
<div id="sec-proxy-chain-request-processing-observe">
<section id="section-8.1.1">
          <h4 id="name-supporting-observe-6">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-supporting-observe-6" class="section-name selfRef">Supporting Observe</a>
          </h4>
<p id="section-8.1.1-1">When using CoAP Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, what is defined in <a href="#ssec-req-proc-proxy-observe" class="auto internal xref">Section 5.2.2</a> applies for the last proxy in the chain, i.e., the last hop before the origin servers.<a href="#section-8.1.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1.1-2">Any other proxy in the chain acts as a client and registers its own interest to observe the target resource with the next hop towards the origin servers, as per <span><a href="https://rfc-editor.org/rfc/rfc7641#section-5" class="relref">Section 5</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>.<a href="#section-8.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-proxy-chain-response-processing">
<section id="section-8.2">
        <h3 id="name-response-processing-at-the-p">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-response-processing-at-the-p" class="section-name selfRef">Response Processing at the Proxy</a>
        </h3>
<p id="section-8.2-1">Upon receiving a response matching with the group request before the amount of time T' has elapsed, the proxy proceeds as follows.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">If the proxy is the last one in the chain, i.e., it is the last hop before the origin servers, the proxy performs the steps defined in <a href="#ssec-resp-proc-proxy" class="auto internal xref">Section 5.4</a> if it is a forward-proxy or in <a href="#sec-reverse-proxies-proxy-side" class="auto internal xref">Section 6.1</a> if it is a reverse-proxy, with no modifications.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<p id="section-8.2-3">Otherwise, the proxy performs the steps defined in <a href="#ssec-resp-proc-proxy" class="auto internal xref">Section 5.4</a>, with the following differences.<a href="#section-8.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-4.1">
            <p id="section-8.2-4.1.1">In any of the two following cases, the proxy skips Step 1, hence the proxy <span class="bcp14">MUST NOT</span> remove, alter, or replace the Reply-From Option.<a href="#section-8.2-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-4.1.2.1">
                <p id="section-8.2-4.1.2.1.1">The chain is composed of forward-proxies.<a href="#section-8.2-4.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.2-4.1.2.2">
                <p id="section-8.2-4.1.2.2.1">The chain is composed of reverse-proxies, and the last reverse-proxy (in fact, the whole chain) stands in only for the whole group of servers, but not for the individual servers in the group (see <a href="#sec-reverse-proxies-proxy-side" class="auto internal xref">Section 6.1</a>).<a href="#section-8.2-4.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-8.2-4.1.3">
This ensures that, when receiving a response to a group request and consuming the Reply-From Option, the origin client can retrieve addressing information that is directly associated with the origin server that generated the response.<a href="#section-8.2-4.1.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-4.2">
            <p id="section-8.2-4.2.1">At Step 1, the following applies in case the chain is composed of reverse-proxies, and the last reverse-proxy (in fact, the whole chain) stands in both for the whole group of servers and for the individual origin servers in the group (see <a href="#sec-reverse-proxies-proxy-side" class="auto internal xref">Section 6.1</a>).<a href="#section-8.2-4.2.1" class="pilcrow">¶</a></p>
<p id="section-8.2-4.2.2">
In the Reply-From Option, the proxy <span class="bcp14">MUST</span> replace the old value TARGET_OLD. The new value TARGET_NEW specifies addressing information directly associated with the proxy. The new value is such that, when receiving a unicast request that has been sent according to what is specified in TARGET_NEW, the proxy forwards the request according to what was specified in TARGET_OLD, i.e., to the next hop towards the origin server that generated the response.<a href="#section-8.2-4.2.2" class="pilcrow">¶</a></p>
<p id="section-8.2-4.2.3">
This ensures that, when receiving a response to a group request and consuming the Reply-From Option, the origin client can retrieve addressing information that is directly associated with the first reverse-proxy in the chain, i.e., with the next hop towards the origin server that generated the response.<a href="#section-8.2-4.2.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-4.3">
            <p id="section-8.2-4.3.1">At Step 2, "client" refers to the origin client when the proxy is the first one in the chain, or to the previous hop proxy closer to the origin client otherwise.<a href="#section-8.2-4.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.2-5">As to the possible reception of multiple responses to the same group request from the same (next hop proxy towards the) origin server, the same as defined in <a href="#ssec-resp-proc-proxy-steps" class="auto internal xref">Section 5.4.1</a> applies. That is, as long as the proxy forwards responses to a group request back to the (previous hop proxy closer to the) origin client, the proxy <span class="bcp14">MUST</span> follow the steps above and forward also such multiple responses "as they come".<a href="#section-8.2-5" class="pilcrow">¶</a></p>
<p id="section-8.2-6">Upon timeout expiration, i.e., T' seconds after having forwarded the group request to the next hop towards the origin servers, the proxy frees up its local Token value associated with that request. Thus, following late responses to the same group request will be discarded and not forwarded back to the (previous hop proxy closer to the) origin client.<a href="#section-8.2-6" class="pilcrow">¶</a></p>
<div id="sec-proxy-chain-response-processing-observe">
<section id="section-8.2.1">
          <h4 id="name-supporting-observe-7">
<a href="#section-8.2.1" class="section-number selfRef">8.2.1. </a><a href="#name-supporting-observe-7" class="section-name selfRef">Supporting Observe</a>
          </h4>
<p id="section-8.2.1-1">When using CoAP Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, what is defined in <a href="#ssec-resp-proc-proxy-observe" class="auto internal xref">Section 5.4.2</a> applies for the last proxy in the chain, i.e., the last hop before the origin servers.<a href="#section-8.2.1-1" class="pilcrow">¶</a></p>
<p id="section-8.2.1-2">As to any other proxy in the chain, the following applies.<a href="#section-8.2.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2.1-3.1">
              <p id="section-8.2.1-3.1.1">The proxy acts as a client registered with the next hop towards the origin servers, as described earlier in <a href="#sec-proxy-chain-request-processing-observe" class="auto internal xref">Section 8.1.1</a>.<a href="#section-8.2.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.2.1-3.2">
              <p id="section-8.2.1-3.2.1">The proxy takes the role of a server when forwarding notifications from the next hop towards the origin servers back to the (previous hop proxy closer to the) origin client, as per <span><a href="https://rfc-editor.org/rfc/rfc7641#section-5" class="relref">Section 5</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>.<a href="#section-8.2.1-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.2.1-3.3">
              <p id="section-8.2.1-3.3.1">The proxy frees up its Token value used for a group observation only if, after the timeout expiration, no 2.xx (Success) responses matching with the group request and also including an Observe Option have been received from the next hop towards the origin servers.<a href="#section-8.2.1-3.3.1" class="pilcrow">¶</a></p>
<p id="section-8.2.1-3.3.2">
Otherwise, after the timeout expiration and as long as the observation for the target resource of the group request is active with the next hop towards the origin servers in the group, notifications from that hop are forwarded back to the (previous hop proxy closer to the) origin client, as defined in <a href="#sec-proxy-chain-response-processing" class="auto internal xref">Section 8.2</a>.<a href="#section-8.2.1-3.3.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.2.1-3.4">
              <p id="section-8.2.1-3.4.1">The proxy <span class="bcp14">SHOULD</span> regularly verify that the (previous hop proxy closer to the) origin client is still interested in receiving observe notifications for a group observation. To this end, the proxy can rely on the same approach defined in <span><a href="https://rfc-editor.org/rfc/rfc7641#section-4.5" class="relref">Section 4.5</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>.<a href="#section-8.2.1-3.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-http-to-coap-proxies">
<section id="section-9">
      <h2 id="name-http-to-coap-proxies">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-http-to-coap-proxies" class="section-name selfRef">HTTP-to-CoAP Proxies</a>
      </h2>
<p id="section-9-1">This section defines the components needed to use the signaling protocol specified in this document, when an HTTP client wishes to send a group request to the servers of a CoAP group via an HTTP-to-CoAP cross-proxy.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">The following builds on the mapping of the CoAP request/response model to HTTP and vice versa as defined in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-10" class="relref">Section 10</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, as well as on the additional details about the HTTP-to-CoAP mapping defined in <span>[<a href="#RFC8075" class="cite xref">RFC8075</a>]</span>.<a href="#section-9-2" class="pilcrow">¶</a></p>
<p id="section-9-3">Furthermore, the components defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-11" class="relref">Section 11</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> are also used to map and transport OSCORE-protected messages over HTTP. This allows an HTTP client to use Group OSCORE end-to-end with the servers in the CoAP group.<a href="#section-9-3" class="pilcrow">¶</a></p>
<div id="sec-multicast-timeout-header">
<section id="section-9.1">
        <h3 id="name-the-http-multicast-timeout-">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-the-http-multicast-timeout-" class="section-name selfRef">The HTTP Multicast-Timeout Header Field</a>
        </h3>
<p id="section-9.1-1">The HTTP Multicast-Timeout header field (see <a href="#iana-message-headers" class="auto internal xref">Section 11.2</a>) is used for carrying the content otherwise specified in the CoAP Multicast-Timeout Option defined in <a href="#sec-multicast-timeout-option" class="auto internal xref">Section 2</a>.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">Using the Augmented Backus-Naur Form (ABNF) notation of <span>[<a href="#RFC5234" class="cite xref">RFC5234</a>]</span> and including the core ABNF syntax rule DIGIT (decimal digits) defined by that specification, the HTTP Multicast-Timeout header field value is as follows.<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<p id="section-9.1-3">Multicast-Timeout = *DIGIT<a href="#section-9.1-3" class="pilcrow">¶</a></p>
<p id="section-9.1-4">The empty header field is equivalent to the header field conveying the value 0.<a href="#section-9.1-4" class="pilcrow">¶</a></p>
<p id="section-9.1-5">When translating a CoAP message into an HTTP message, the HTTP Multicast-Timeout header field is set with the content of the CoAP Multicast-Timeout Option, or is left empty in case the option is empty.<a href="#section-9.1-5" class="pilcrow">¶</a></p>
<p id="section-9.1-6">When translating an HTTP message into a CoAP message, the CoAP Multicast-Timeout Option is set with the content of the HTTP Multicast-Timeout header field, or is left empty in case the header field is empty.<a href="#section-9.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-reply-from-header">
<section id="section-9.2">
        <h3 id="name-the-http-reply-from-header-">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-the-http-reply-from-header-" class="section-name selfRef">The HTTP Reply-From Header Field</a>
        </h3>
<p id="section-9.2-1">The HTTP Reply-From header field (see <a href="#iana-message-headers" class="auto internal xref">Section 11.2</a>) is used for carrying the content otherwise specified in the CoAP Reply-From Option defined in <a href="#sec-reply-from-option" class="auto internal xref">Section 3</a>. Its use is intended only for HTTP responses.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2-2">Reply-From is a List Structured Header Field <span>[<a href="#RFC9651" class="cite xref">RFC9651</a>]</span>. The List <span class="bcp14">MUST</span> be composed of exactly one or two members. Each member of the List <span class="bcp14">MUST</span> be a Byte Sequence Item. Any deviation from such format <span class="bcp14">MUST</span> cause the entire header field to be ignored.<a href="#section-9.2-2" class="pilcrow">¶</a></p>
<p id="section-9.2-3">The value of the header field specifies addressing information pertaining to the origin server that generated the CoAP response corresponding to the HTTP response. The client can use this information in order to send an individual request intended to that server.<a href="#section-9.2-3" class="pilcrow">¶</a></p>
<p id="section-9.2-4">When translating a CoAP message into an HTTP message, the value of the HTTP Reply-From header field is built as follows.<a href="#section-9.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2-5.1">
            <p id="section-9.2-5.1.1">The first Byte Sequence Item encodes the byte serialization of the first CBOR array of the CBOR sequence that is specified as value of the CoAP Reply-From Option.<a href="#section-9.2-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.2-5.2">
            <p id="section-9.2-5.2.1">The second Byte Sequence Item encodes the byte serialization of the second CBOR array (if present) of the CBOR sequence that is specified as value of the CoAP Reply-From Option.<a href="#section-9.2-5.2.1" class="pilcrow">¶</a></p>
<p id="section-9.2-5.2.2">
If the CBOR sequence in the CoAP Reply-From Option does not include the second CBOR array, then this Byte Sequence Item <span class="bcp14">MUST NOT</span> be included in the List of the HTTP Reply-From header field.<a href="#section-9.2-5.2.2" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-9.2-6">When translating an HTTP message into a CoAP message, the value of the CoAP Reply-From Option is built as follows.<a href="#section-9.2-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2-7.1">
            <p id="section-9.2-7.1.1">The first CBOR array of the CBOR sequence is obtained by decoding the first Byte Sequence Item in the List that is specified as value of the HTTP Reply-From header field.<a href="#section-9.2-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.2-7.2">
            <p id="section-9.2-7.2.1">The second CBOR array of the CBOR sequence is obtained by decoding the second Byte Sequence Item (if present) in the List that is specified as value of the HTTP Reply-From header field.<a href="#section-9.2-7.2.1" class="pilcrow">¶</a></p>
<p id="section-9.2-7.2.2">
If the List of the HTTP Reply-From header field does not include the second Byte Sequence Item, then this second CBOR array <span class="bcp14">MUST NOT</span> be included in the CBOR sequence of the CoAP Reply-From Option.<a href="#section-9.2-7.2.2" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-group-etag-header">
<section id="section-9.3">
        <h3 id="name-the-http-group-etag-header-">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-the-http-group-etag-header-" class="section-name selfRef">The HTTP Group-ETag Header Field</a>
        </h3>
<p id="section-9.3-1">The HTTP Group-ETag header field (see <a href="#iana-message-headers" class="auto internal xref">Section 11.2</a>) is used for carrying the content otherwise specified in the CoAP Group-ETag Option defined in <a href="#sec-proxy-caching-validation-c-p" class="auto internal xref">Section 7.3</a>.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<p id="section-9.3-2">Group-ETag is a List Structured Header Field <span>[<a href="#RFC9651" class="cite xref">RFC9651</a>]</span>. The List <span class="bcp14">MUST</span> be composed of one or more members in HTTP requests and by exactly one member in HTTP responses. Each member of the List <span class="bcp14">MUST</span> be a Byte Sequence Item. Any deviation from such format <span class="bcp14">MUST</span> cause the entire header field to be ignored.<a href="#section-9.3-2" class="pilcrow">¶</a></p>
<p id="section-9.3-3">The value of the header field specifies a set of entity-tag values, each of which is associated with a set of cache entries at the proxy that can be hit by a group request (see <a href="#sec-proxy-caching-validation-c-p" class="auto internal xref">Section 7.3</a>).<a href="#section-9.3-3" class="pilcrow">¶</a></p>
<p id="section-9.3-4">When translating a CoAP message into an HTTP message, the value of the HTTP Group-ETag header field is built as follows.<a href="#section-9.3-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.3-5.1">
            <p id="section-9.3-5.1.1">When translating a CoAP request to an HTTP request, the List of the HTTP Group-ETag header field <span class="bcp14">MUST</span> include N members, where N is the number of CoAP Group-ETag Options in the CoAP request. The i-th member of the List encodes the value specified in the i-th CoAP Group-ETag Option in the CoAP request.<a href="#section-9.3-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.3-5.2">
            <p id="section-9.3-5.2.1">When translating a CoAP response to an HTTP response, the List of the HTTP Group-ETag header field <span class="bcp14">MUST</span> include one member, which encodes the value specified in the CoAP Group-ETag Option in the CoAP response.<a href="#section-9.3-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-9.3-6">When translating an HTTP message into a CoAP message, the value of the CoAP Group-ETag Options is built as follows.<a href="#section-9.3-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.3-7.1">
            <p id="section-9.3-7.1.1">When translating an HTTP request to a CoAP request, N CoAP Group-ETag Options are included in the CoAP request, where N is the number of members of the List of the HTTP Group-ETag header field. The value of the i-th CoAP Group-ETag Option is obtained by decoding the i-th member of the List of the HTTP Group-ETag header field.<a href="#section-9.3-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.3-7.2">
            <p id="section-9.3-7.2.1">When translating an HTTP response to a CoAP response, one CoAP Group-ETag Option is included in the CoAP response. The value of the CoAP Group-ETag Option is obtained by decoding the only member of the List of the HTTP Group-ETag header field.<a href="#section-9.3-7.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-9.3-8">When sending to the HTTP-to-CoAP proxy an HTTP GET request to be translated into a CoAP GET request intended to the CoAP group, the client <span class="bcp14">MAY</span> include one HTTP Group-ETag header field in the request. The field value is a list of one or more members, each of which encodes one entity-tag value that is applicable to the set J of cache entries that can be hit by the request (see <a href="#sec-proxy-caching-validation-c-p" class="auto internal xref">Section 7.3</a>).<a href="#section-9.3-8" class="pilcrow">¶</a></p>
<p id="section-9.3-9">An HTTP-to-CoAP proxy that performs the form of validation defined in <a href="#sec-proxy-caching-validation-c-p" class="auto internal xref">Section 7.3</a> proceeds like defined in <a href="#sec-proxy-caching-validation-c-p" class="auto internal xref">Section 7.3</a> for a CoAP-to-CoAP proxy, with the following differences.<a href="#section-9.3-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.3-10.1">
            <p id="section-9.3-10.1.1">When sending to the client an HTTP 200 (OK) response to an HTTP GET request that was translated into a CoAP GET request sent to the CoAP group, the proxy <span class="bcp14">MAY</span> include one HTTP Group-ETag header field in the response, in case the set J is "complete". The field value is a List composed of one member, which encodes the entity-tag value currently associated with the set J.<a href="#section-9.3-10.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.3-10.2">
            <p id="section-9.3-10.2.1">When the HTTP-to-CoAP proxy receives an HTTP GET request to be translated into a CoAP GET request intended to the CoAP group and that includes an HTTP Group-ETag header field, the following applies.<a href="#section-9.3-10.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.3-10.2.2.1">
                <p id="section-9.3-10.2.2.1.1">As to the entity-tag values used to check for possible cache hits, the HTTP-to-CoAP proxy obtains those values by decoding the members of the List of the HTTP Group-ETag header field in the HTTP request.<a href="#section-9.3-10.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.3-10.2.2.2">
                <p id="section-9.3-10.2.2.2.1">If the same conditions for which a CoAP-to-CoAP proxy would reply with a single CoAP 2.03 (Valid) response hold, then the HTTP-to-CoAP proxy replies with a single HTTP 304 (Not Modified) response. The response <span class="bcp14">MUST</span> include one HTTP Group-ETag header field whose value is a List composed of one member, which encodes the current entity-tag value of the set J.<a href="#section-9.3-10.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-9.3-11">An HTTP 304 (Not Modified) response from the HTTP-to-CoAP proxy indicates to the client that it is possible to reuse the stored responses identified by the entity-tag encoded by the only member of the List of the HTTP Group-ETag header field.<a href="#section-9.3-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-cross-proxies-client-req">
<section id="section-9.4">
        <h3 id="name-request-sending-at-the-clien">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-request-sending-at-the-clien" class="section-name selfRef">Request Sending at the Client</a>
        </h3>
<p id="section-9.4-1">The client proceeds according to the following steps.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-9.4-2">
<li id="section-9.4-2.1">
            <p id="section-9.4-2.1.1">The client prepares an HTTP request to send to the proxy via IP unicast, and to be forwarded by the proxy to the targeted group of CoAP servers over IP multicast. With reference to <span><a href="https://rfc-editor.org/rfc/rfc8075#section-5" class="relref">Section 5</a> of [<a href="#RFC8075" class="cite xref">RFC8075</a>]</span>, the request is addressed to a Hosting HTTP URI, such that the proxy can extract the Target CoAP URI as the group URI where to forward the request.<a href="#section-9.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.4-2.2">
            <p id="section-9.4-2.2.1">The client determines the amount of time T that it is fine to wait for a response to the request from the proxy. Then, the client determines the amount of time T' &lt; T, where the difference (T - T') should be at least the expected worst-case round-trip time between the client and the proxy.<a href="#section-9.4-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.4-2.3">
            <p id="section-9.4-2.3.1">If Group OSCORE is used end-to-end between the client and the servers, the client translates the HTTP request into a CoAP request, as per <span>[<a href="#RFC8075" class="cite xref">RFC8075</a>]</span>. Then, the client protects the resulting CoAP request by using Group OSCORE, as defined in <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>. Finally, the protected CoAP request is mapped to HTTP as defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-11.2" class="relref">Section 11.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. Later on, the resulting HTTP request <span class="bcp14">MUST</span> be sent in compliance with the rules in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-11.1" class="relref">Section 11.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-9.4-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.4-2.4">
            <p id="section-9.4-2.4.1">The client includes the HTTP Multicast-Timeout header field in the request, specifying T' as its value. The client can specify T' = 0, thus indicating to be not interested in receiving responses from the origin servers through the proxy.<a href="#section-9.4-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.4-2.5">
            <p id="section-9.4-2.5.1">If the client wishes to revalidate responses to a previous group request from the corresponding cache entries at the proxy (see <a href="#sec-proxy-caching-validation-c-p" class="auto internal xref">Section 7.3</a>), the client includes one or multiple HTTP Group-ETag header fields in the request (see <a href="#sec-group-etag-header" class="auto internal xref">Section 9.3</a>), each specifying an entity-tag value like they would in a corresponding CoAP Group E-Tag Option.<a href="#section-9.4-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.4-2.6">
            <p id="section-9.4-2.6.1">The client sends the request to the proxy, as a unicast HTTP message. In particular, the client protects the request according to the security association that it has with the proxy.<a href="#section-9.4-2.6.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="sec-cross-proxies-proxy-req">
<section id="section-9.5">
        <h3 id="name-request-processing-at-the-pro">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-request-processing-at-the-pro" class="section-name selfRef">Request Processing at the Proxy</a>
        </h3>
<p id="section-9.5-1">The proxy translates the HTTP request to a CoAP request, as per <span>[<a href="#RFC8075" class="cite xref">RFC8075</a>]</span>. The additional rules for HTTP messages with the HTTP Multicast-Timeout header field and HTTP Group-ETag header field are defined in <a href="#sec-multicast-timeout-header" class="auto internal xref">Section 9.1</a> and <a href="#sec-group-etag-header" class="auto internal xref">Section 9.3</a>, respectively.<a href="#section-9.5-1" class="pilcrow">¶</a></p>
<p id="section-9.5-2">Once translated the HTTP request into a CoAP request, the proxy <span class="bcp14">MUST</span> perform the steps defined in <a href="#ssec-req-proc-proxy" class="auto internal xref">Section 5.2</a>. If the proxy supports caching of responses, it can serve the unicast request also by using cached responses as per <a href="#sec-proxy-caching" class="auto internal xref">Section 7</a>, considering the CoAP request above as the potentially matching request.<a href="#section-9.5-2" class="pilcrow">¶</a></p>
<p id="section-9.5-3">In addition, in case the HTTP Multicast-Timeout header field had value 0, the proxy replies to the client with an HTTP response with status code 204 (No Content), right after forwarding the group request to the group of servers.<a href="#section-9.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-cross-proxies-proxy-resp">
<section id="section-9.6">
        <h3 id="name-response-processing-at-the-pr">
<a href="#section-9.6" class="section-number selfRef">9.6. </a><a href="#name-response-processing-at-the-pr" class="section-name selfRef">Response Processing at the Proxy</a>
        </h3>
<p id="section-9.6-1">Upon receiving a CoAP response matching with the group request before the amount of time T' &gt; 0 has elapsed, the proxy includes the Reply-From Option in the response, as per Step 1 of <a href="#ssec-resp-proc-proxy-steps" class="auto internal xref">Section 5.4.1</a>. Then, the proxy translates the CoAP response to an HTTP response, as per <span><a href="https://rfc-editor.org/rfc/rfc7252#section-10.1" class="relref">Section 10.1</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> and <span>[<a href="#RFC8075" class="cite xref">RFC8075</a>]</span>, as well as <span><a href="https://rfc-editor.org/rfc/rfc8613#section-11.2" class="relref">Section 11.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> if Group OSCORE is used end-to-end between the client and servers. The additional rules for CoAP messages specifying the Reply-From Option are defined in <a href="#sec-reply-from-header" class="auto internal xref">Section 9.2</a>.<a href="#section-9.6-1" class="pilcrow">¶</a></p>
<p id="section-9.6-2">After that, the proxy stores the resulting HTTP response until the timeout with original value T' &gt; 0 expires. If, before then, the proxy receives another response to the same group request from the same CoAP server, the proxy performs the steps above, and stores the resulting HTTP response by superseding the currently stored one from that server.<a href="#section-9.6-2" class="pilcrow">¶</a></p>
<p id="section-9.6-3">When the timeout expires, if no responses have been received from the servers, the proxy replies to the client's original unicast group request with an HTTP response with status code 204 (No Content).<a href="#section-9.6-3" class="pilcrow">¶</a></p>
<p id="section-9.6-4">Otherwise, the proxy relays to the client all the collected and stored HTTP responses to the group request, according to the following steps.<a href="#section-9.6-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-9.6-5">
<li id="section-9.6-5.1">
            <p id="section-9.6-5.1.1">The proxy prepares a single HTTP batch response, which <span class="bcp14">MUST</span> have 200 (OK) status code and <span class="bcp14">MUST</span> have its HTTP Content-Type header field with value multipart/mixed <span>[<a href="#RFC2046" class="cite xref">RFC2046</a>]</span>.<a href="#section-9.6-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.6-5.2">
            <p id="section-9.6-5.2.1">For each stored individual HTTP response RESP, the proxy prepares a corresponding batch part to include in the HTTP batch response, such that:<a href="#section-9.6-5.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.6-5.2.2.1">
                <p id="section-9.6-5.2.2.1.1">The batch part has its own HTTP Content-Type header field with value application/http <span>[<a href="#RFC9112" class="cite xref">RFC9112</a>]</span>.<a href="#section-9.6-5.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.6-5.2.2.2">
                <p id="section-9.6-5.2.2.2.1">The body of the batch part is the individual HTTP response RESP, including its status code, headers, and body.<a href="#section-9.6-5.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="section-9.6-5.3">
            <p id="section-9.6-5.3.1">The proxy includes each batch part prepared at Step 2 in the HTTP batch response.<a href="#section-9.6-5.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.6-5.4">
            <p id="section-9.6-5.4.1">The proxy replies to the client's original unicast group request, by sending the HTTP batch response. When doing so, the proxy protects the response according to the security association that it has with the client.<a href="#section-9.6-5.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="sec-cross-proxies-client-resp">
<section id="section-9.7">
        <h3 id="name-response-processing-at-the-cl">
<a href="#section-9.7" class="section-number selfRef">9.7. </a><a href="#name-response-processing-at-the-cl" class="section-name selfRef">Response Processing at the Client</a>
        </h3>
<p id="section-9.7-1">When it receives an HTTP response as a reply to the original unicast group request, the client proceeds as follows.<a href="#section-9.7-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-9.7-2">
<li id="section-9.7-2.1">
            <p id="section-9.7-2.1.1">The client decrypts and verifies the response, according to the security association that it has with the proxy.<a href="#section-9.7-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.7-2.2">
            <p id="section-9.7-2.2.1">From the resulting HTTP batch response, the client extracts the different batch parts.<a href="#section-9.7-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.7-2.3">
            <p id="section-9.7-2.3.1">From each of the extracted batch parts, the client extracts the body as one of the individual HTTP response RESP.<a href="#section-9.7-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.7-2.4">
            <p id="section-9.7-2.4.1">For each individual HTTP response RESP, the client performs the following steps.<a href="#section-9.7-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.7-2.4.2.1">
                <p id="section-9.7-2.4.2.1.1">If Group OSCORE is used end-to-end between the client and servers, the client translates the HTTP response RESP into a CoAP response, as per <span><a href="https://rfc-editor.org/rfc/rfc8613#section-11.3" class="relref">Section 11.3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. Then, the client decrypts and verifies the resulting CoAP response by using Group OSCORE, as defined in <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>. Finally, the decrypted CoAP response is mapped to HTTP as per <span><a href="https://rfc-editor.org/rfc/rfc7252#section-10.2" class="relref">Section 10.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> as well as <span>[<a href="#RFC8075" class="cite xref">RFC8075</a>]</span>. The additional rules for HTTP messages with the HTTP Reply-From header field are defined in <a href="#sec-reply-from-header" class="auto internal xref">Section 9.2</a>.<a href="#section-9.7-2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.7-2.4.2.2">
                <p id="section-9.7-2.4.2.2.1">The client delivers to the application the individual HTTP response.<a href="#section-9.7-2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-9.7-2.4.3">
Similarly to Step 3 in <a href="#ssec-resp-proc-client-steps" class="auto internal xref">Section 5.5.1</a>, the client identifies the origin server that originated the CoAP response corresponding to the HTTP response RESP, by means of the addressing information specified as value of the HTTP Reply-From header field. This allows the client to distinguish different individual HTTP responses as corresponding to different CoAP responses from the servers in the CoAP group.<a href="#section-9.7-2.4.3" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="sec-cross-proxies-example">
<section id="section-9.8">
        <h3 id="name-example-2">
<a href="#section-9.8" class="section-number selfRef">9.8. </a><a href="#name-example-2" class="section-name selfRef">Example</a>
        </h3>
<p id="section-9.8-1">The examples in this section build on <a href="#sec-workflow-example" class="auto internal xref">Section 5.6</a>, with the difference that the origin client C is an HTTP client and the proxy P is an HTTP-to-CoAP cross-proxy. The examples are simply illustrative and are not to be intended as a test vector.<a href="#section-9.8-1" class="pilcrow">¶</a></p>
<p id="section-9.8-2">The following is an example of unicast group request sent by C to P. The URI mapping and notation are based on the "Simple Form" defined in <span><a href="https://rfc-editor.org/rfc/rfc8075#section-5.4.1" class="relref">Section 5.4.1</a> of [<a href="#RFC8075" class="cite xref">RFC8075</a>]</span>.<a href="#section-9.8-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.8-3">
<pre>
POST https://proxy.url/hc/?target_uri=coap://G_ADDR:G_PORT/ HTTP/1.1
Content-Length: &lt;REQUEST_TOTAL_CONTENT_LENGTH&gt;
Content-Type: text/plain
Multicast-Timeout: 60

Body: Do that!
</pre><a href="#section-9.8-3" class="pilcrow">¶</a>
</div>
<p id="section-9.8-4"></p>
<p id="section-9.8-5">The following is an example of HTTP batch response sent by P to C, as a reply to the client's original unicast group request<a href="#section-9.8-5" class="pilcrow">¶</a></p>
<p id="section-9.8-6">For readability, base64url(cri'X') denotes the base64url encoding of cri'X' without padding (see <span><a href="https://rfc-editor.org/rfc/rfc4648#section-5" class="relref">Section 5</a> of [<a href="#RFC4648" class="cite xref">RFC4648</a>]</span>), and cri'X' denotes the byte serialization of a CRI corresponding to the URI X.<a href="#section-9.8-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.8-7">
<pre>
HTTP/1.1 200 OK
Content-Length: &lt;BATCH_RESPONSE_TOTAL_CONTENT_LENGTH&gt;
Content-Type: multipart/mixed; boundary=batch_foo_bar

--batch_foo_bar
Content-Type: application/http

HTTP/1.1 200 OK
Content-Type: text/plain
Content-Length: &lt;INDIVIDUAL_RESPONSE_1_CONTENT_LENGTH&gt;
Reply-From: base64url(cri'coap://S1_ADDR:G_PORT')

Body: Done!
--batch_foo_bar
Content-Type: application/http

HTTP/1.1 200 OK
Content-Type: text/plain
Content-Length: &lt;INDIVIDUAL_RESPONSE_2_CONTENT_LENGTH&gt;
Reply-From: base64url(cri'coap://S2_ADDR:S2_PORT')

Body: More than done!
--batch_foo_bar--
</pre><a href="#section-9.8-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sec-resp-streaming">
<section id="section-9.9">
        <h3 id="name-streamed-delivery-of-respon">
<a href="#section-9.9" class="section-number selfRef">9.9. </a><a href="#name-streamed-delivery-of-respon" class="section-name selfRef">Streamed Delivery of Responses to the Client</a>
        </h3>
<p id="section-9.9-1">[ TODO<a href="#section-9.9-1" class="pilcrow">¶</a></p>
<p id="section-9.9-2">The proxy might still be able to forward back individual responses to the client in a streamed fashion.<a href="#section-9.9-2" class="pilcrow">¶</a></p>
<p id="section-9.9-3">Individual responses can be forwarded back one by one as they come (like a CoAP-to-CoAP proxy does), or as soon as a certain amount of them has been received from the servers.<a href="#section-9.9-3" class="pilcrow">¶</a></p>
<p id="section-9.9-4">This can be achieved by combining the Content-Type multipart/mixed used in the previous sections with the Transfer-Coding "chunked" specified in RFC 9112.<a href="#section-9.9-4" class="pilcrow">¶</a></p>
<p id="section-9.9-5">The above applies to HTTP 1.1, while HTTP/2 has its own mechanisms for data streaming.<a href="#section-9.9-5" class="pilcrow">¶</a></p>
<p id="section-9.9-6">]<a href="#section-9.9-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-reverse-proxies-http-to-coap">
<section id="section-9.10">
        <h3 id="name-reverse-proxies-2">
<a href="#section-9.10" class="section-number selfRef">9.10. </a><a href="#name-reverse-proxies-2" class="section-name selfRef">Reverse-Proxies</a>
        </h3>
<p id="section-9.10-1">In case an HTTP-to-CoAP proxy acts specifically as a reverse-proxy, the same principles defined in <a href="#sec-reverse-proxies" class="auto internal xref">Section 6</a> apply, as specified below.<a href="#section-9.10-1" class="pilcrow">¶</a></p>
<div id="sec-reverse-proxies-client-side-http">
<section id="section-9.10.1">
          <h4 id="name-processing-on-the-client-sid">
<a href="#section-9.10.1" class="section-number selfRef">9.10.1. </a><a href="#name-processing-on-the-client-sid" class="section-name selfRef">Processing on the Client Side</a>
          </h4>
<p id="section-9.10.1-1">If an HTTP client sends a request intended to a group of servers and is aware of actually communicating with a reverse-proxy, then the client <span class="bcp14">MUST</span> perform the steps defined in <a href="#sec-cross-proxies-client-req" class="auto internal xref">Section 9.4</a>. In particular, this results in a request sent to the proxy including a Multicast-Timeout header field.<a href="#section-9.10.1-1" class="pilcrow">¶</a></p>
<p id="section-9.10.1-2">The client processes the HTTP response forwarded back by the proxy as defined in <a href="#sec-cross-proxies-client-resp" class="auto internal xref">Section 9.7</a>. If the client wishes to send a follow-up unicast request intended only to one of the CoAP servers that generated the response, the same concepts defined in <a href="#sec-reverse-proxies-client-side" class="auto internal xref">Section 6.2</a> apply to the composition of HTTP requests.<a href="#section-9.10.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-reverse-proxies-proxy-side-http">
<section id="section-9.10.2">
          <h4 id="name-processing-on-the-proxy-side">
<a href="#section-9.10.2" class="section-number selfRef">9.10.2. </a><a href="#name-processing-on-the-proxy-side" class="section-name selfRef">Processing on the Proxy Side</a>
          </h4>
<p id="section-9.10.2-1">If the proxy receives a request and determines that the request should be forwarded to a group of servers over IP multicast, then the same as defined in <a href="#sec-cross-proxies-proxy-req" class="auto internal xref">Section 9.5</a> applies, with the following difference.<a href="#section-9.10.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.10.2-2.1">
              <p id="section-9.10.2-2.1.1">Once translated the HTTP request into a CoAP request, the proxy performs what is defined in <a href="#sec-reverse-proxies-proxy-side" class="auto internal xref">Section 6.1</a>.<a href="#section-9.10.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-9.10.2-3">The proxy processes the HTTP response sent to the client as defined in <a href="#sec-cross-proxies-proxy-resp" class="auto internal xref">Section 9.6</a>.<a href="#section-9.10.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-security-considerations">
<section id="section-10">
      <h2 id="name-security-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-10-1">The security considerations from <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, and <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span> hold for this document.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">When a chain of proxies is used (see <a href="#sec-proxy-chain" class="auto internal xref">Section 8</a>), the secure communication between any two adjacent hops is independent of that between any other two adjacent hops.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3">When Group OSCORE is used for end-to-end secure group communication between the origin client and the origin servers, this security association is unaffected by the possible presence of a proxy or a chain of proxies.<a href="#section-10-3" class="pilcrow">¶</a></p>
<p id="section-10-4">Furthermore, the following additional considerations hold.<a href="#section-10-4" class="pilcrow">¶</a></p>
<div id="sec-security-considerations-client-auth">
<section id="section-10.1">
        <h3 id="name-client-authentication">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-client-authentication" class="section-name selfRef">Client Authentication</a>
        </h3>
<p id="section-10.1-1">As per the requirement REQ2 (see <a href="#sec-objectives" class="auto internal xref">Section 4</a>), the client has to authenticate to the proxy when sending a group request to forward. This leverages an established security association between the client and the proxy, which the client uses to protect the group request before sending it to the proxy.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<p id="section-10.1-2">If the group request is also protected end-to-end between the client and the origin servers using the group mode of Group OSCORE, the proxy can act as external signature checker (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-23#section-7.5" class="relref">Section 7.5</a> of [<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>) and authenticate the client by successfully verifying the signature embedded in the group request. However, this requires the proxy to store, for each client to authenticate, the authentication credential that the client uses in the OSCORE group and the public key included therein, and to also store the authentication credential of the Group Manager responsible for the OSCORE group. This in turn would require a form of active synchronization between the proxy and the Group Manager for that group <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>.<a href="#section-10.1-2" class="pilcrow">¶</a></p>
<p id="section-10.1-3">Nevertheless, the client and the proxy <span class="bcp14">SHOULD</span> still rely on a full-fledged pairwise secure association. In addition to ensuring the integrity of group requests sent to the proxy (see <a href="#sec-security-considerations-opt1" class="auto internal xref">Section 10.2</a>, <a href="#sec-security-considerations-opt2" class="auto internal xref">Section 10.3</a>, and <a href="#sec-security-considerations-opt3" class="auto internal xref">Section 10.4</a>), this prevents the proxy from forwarding replayed group requests with a valid signature, as possibly injected by an active, on-path adversary.<a href="#section-10.1-3" class="pilcrow">¶</a></p>
<p id="section-10.1-4">The same considerations apply when a chain of proxies is used (see <a href="#sec-proxy-chain" class="auto internal xref">Section 8</a>), with each proxy but the last one in the chain acting as client with the next hop towards the origin servers.<a href="#section-10.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-security-considerations-opt1">
<section id="section-10.2">
        <h3 id="name-multicast-timeout-option">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-multicast-timeout-option" class="section-name selfRef">Multicast-Timeout Option</a>
        </h3>
<p id="section-10.2-1">The Multicast-Timeout Option is of class U for OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. Hence, also when Group OSCORE is used between the client and the servers <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>, a proxy is able to access the option value and retrieve the timeout value T', as well as to remove the option altogether before forwarding the group request to the servers. When a chain of proxies is used (see <a href="#sec-proxy-chain" class="auto internal xref">Section 8</a>), this also allows each proxy but the last one in the chain to update the option value, as an indication for the next hop towards the origin servers (see <a href="#sec-proxy-chain-request-processing" class="auto internal xref">Section 8.1</a>).<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<p id="section-10.2-2">The security association between the client and the proxy <span class="bcp14">MUST</span> provide message integrity, so that further intermediaries between the two as well as on-path active adversaries are not able to undetectably remove the option or alter its content, before the group request reaches the proxy.<a href="#section-10.2-2" class="pilcrow">¶</a></p>
<p id="section-10.2-3">Removing the option would result in not forwarding the group request to the servers. Altering the option content would result in the proxy accepting and forwarding back responses for an amount of time different from the one actually indicated by the client.<a href="#section-10.2-3" class="pilcrow">¶</a></p>
<p id="section-10.2-4">The security association between the client and the proxy <span class="bcp14">SHOULD</span> also provide message confidentiality. Otherwise, any further intermediaries between the two as well as any on-path passive adversaries would be able to access the option content, and thus learn for how long the client is willing to receive responses from the servers in the group via the proxy. This may in turn be used by an on-path active adversary to perform a more efficient, selective suppression of responses from the servers.<a href="#section-10.2-4" class="pilcrow">¶</a></p>
<p id="section-10.2-5">When the client protects the unicast request sent to the proxy using OSCORE (see <span>[<a href="#I-D.ietf-core-oscore-capable-proxies" class="cite xref">I-D.ietf-core-oscore-capable-proxies</a>]</span>) and/or (D)TLS, both message integrity and message confidentiality are achieved in the leg between the client and the proxy.<a href="#section-10.2-5" class="pilcrow">¶</a></p>
<p id="section-10.2-6">The same considerations above about security associations apply when a chain of proxies is used (see <a href="#sec-proxy-chain" class="auto internal xref">Section 8</a>), with each proxy but the last one in the chain acting as client with the next hop towards the origin servers.<a href="#section-10.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-security-considerations-opt2">
<section id="section-10.3">
        <h3 id="name-reply-from-option">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-reply-from-option" class="section-name selfRef">Reply-From Option</a>
        </h3>
<p id="section-10.3-1">The Reply-From Option is of class U for OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. Hence, also when Group OSCORE is used between the client and the servers <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>, the proxy that has forwarded the group request to the servers is able to include the option into a server response, before forwarding this response back to the (previous hop proxy closer to the) origin client.<a href="#section-10.3-1" class="pilcrow">¶</a></p>
<p id="section-10.3-2">The security association between the client and the proxy <span class="bcp14">MUST</span> provide message integrity, so that further intermediaries between the two as well as on-path active adversaries are not able to undetectably remove the option from a forwarded server response or alter its content. This ensures that the client can correctly distinguish the different responses and identify the corresponding origin servers.<a href="#section-10.3-2" class="pilcrow">¶</a></p>
<p id="section-10.3-3">The security association between the client and the proxy <span class="bcp14">SHOULD</span> also provide message confidentiality. Otherwise, any further intermediaries between the two as well as any on-path passive adversaries would be able to access the option content, and thus learn the addressing information of servers in the group. This may in turn be used by an on-path active adversary to perform a more efficient, selective suppression of follow-up requests that the client sends to a specific server, either directly, or indirectly via the proxy.<a href="#section-10.3-3" class="pilcrow">¶</a></p>
<p id="section-10.3-4">When the proxy protects the response forwarded back to the client using OSCORE (see <span>[<a href="#I-D.ietf-core-oscore-capable-proxies" class="cite xref">I-D.ietf-core-oscore-capable-proxies</a>]</span>) and/or (D)TLS, both message integrity and message confidentiality are achieved in the leg between the client and the proxy.<a href="#section-10.3-4" class="pilcrow">¶</a></p>
<p id="section-10.3-5">The same considerations above about security associations apply when a chain of proxies is used (see <a href="#sec-proxy-chain" class="auto internal xref">Section 8</a>), with each proxy but the last one in the chain acting as client with the next hop towards the origin servers.<a href="#section-10.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-security-considerations-opt3">
<section id="section-10.4">
        <h3 id="name-group-etag-option">
<a href="#section-10.4" class="section-number selfRef">10.4. </a><a href="#name-group-etag-option" class="section-name selfRef">Group-ETag Option</a>
        </h3>
<p id="section-10.4-1">The Group-ETag Option is of class U for OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. Hence, also when Group OSCORE is used between the client and the servers <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>, a proxy is able to access the option value and use it to possibly perform response revalidation at its cache entries associated with the servers in the CoAP group, as well as to remove the option altogether before forwarding the group request to the servers. When a chain of proxies is used (see <a href="#sec-proxy-chain" class="auto internal xref">Section 8</a>), this also allows each proxy but the last one in the chain to update the option value, to possibly ask the next hop towards the origin servers to perform response revalidation at its cache entries.<a href="#section-10.4-1" class="pilcrow">¶</a></p>
<p id="section-10.4-2">The security association between the client and the proxy <span class="bcp14">MUST</span> provide message integrity, so that further intermediaries between the two as well as on-path active adversaries are not able to undetectably remove the option or alter its content, before the group request reaches the proxy.<a href="#section-10.4-2" class="pilcrow">¶</a></p>
<p id="section-10.4-3">Removing the option would result in the proxy not performing response revalidation at its cache entries associated with the servers in the CoAP group, even though that was what the client asked for.<a href="#section-10.4-3" class="pilcrow">¶</a></p>
<p id="section-10.4-4">Altering the option content in a group request would result in the proxy performing response revalidation based on different entity-tag values from those actually specified by the client. Consequently, the proxy would erroneously reply with multiple 2.05 (Content) responses conveying the full resource representations from its cache entries instead of with a single 2.03 (Valid) response, or vice versa. Instead, altering the option content in a 2.03 (Valid) or 2.05 (Content) response would result in the client wrongly believing that the already stored or the just received representation, respectively, is also the current one, as per the entity value of the tampered Group-ETag Option.<a href="#section-10.4-4" class="pilcrow">¶</a></p>
<p id="section-10.4-5">The security association between the client and the proxy <span class="bcp14">SHOULD</span> also provide message confidentiality. Otherwise, any further intermediaries between the two as well as any on-path passive adversaries would be able to access the option content, and thus learn the rate and pattern according to which the group resource in question changes over time, as inferable from the entity values read over time.<a href="#section-10.4-5" class="pilcrow">¶</a></p>
<p id="section-10.4-6">When the client protects the unicast request sent to the proxy using OSCORE (see <span>[<a href="#I-D.ietf-core-oscore-capable-proxies" class="cite xref">I-D.ietf-core-oscore-capable-proxies</a>]</span>) and/or (D)TLS, both message integrity and message confidentiality are achieved in the leg between the client and the proxy.<a href="#section-10.4-6" class="pilcrow">¶</a></p>
<p id="section-10.4-7">The same considerations above about security associations apply when a chain of proxies is used (see <a href="#sec-proxy-chain" class="auto internal xref">Section 8</a>), with each proxy but the last one in the chain acting as client with the next hop towards the origin servers.<a href="#section-10.4-7" class="pilcrow">¶</a></p>
<p id="section-10.4-8">When caching of Group OSCORE secured responses is enabled at the proxy, the same as defined in <a href="#sec-proxy-caching" class="auto internal xref">Section 7</a> applies, with respect to cache entries and the way they are maintained.<a href="#section-10.4-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-http-to-coap-proxies-sec-con">
<section id="section-10.5">
        <h3 id="name-http-to-coap-proxies-2">
<a href="#section-10.5" class="section-number selfRef">10.5. </a><a href="#name-http-to-coap-proxies-2" class="section-name selfRef">HTTP-to-CoAP Proxies</a>
        </h3>
<p id="section-10.5-1">Consistently with what is discussed in <a href="#sec-security-considerations-client-auth" class="auto internal xref">Section 10.1</a>, an HTTP client has to authenticate to the HTTP-to-CoAP proxy, and they <span class="bcp14">SHOULD</span> rely on a full-fledged pairwise secure association. This can rely on a TLS <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> channel as also recommended in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-12.1" class="relref">Section 12.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> for when OSCORE is used with HTTP, or on a pairwise OSCORE Security Context shared between the client and the proxy as defined in <span>[<a href="#I-D.ietf-core-oscore-capable-proxies" class="cite xref">I-D.ietf-core-oscore-capable-proxies</a>]</span>.<a href="#section-10.5-1" class="pilcrow">¶</a></p>
<p id="section-10.5-2">[ TODO<a href="#section-10.5-2" class="pilcrow">¶</a></p>
<p id="section-10.5-3">Revisit security considerations from <span>[<a href="#RFC8075" class="cite xref">RFC8075</a>]</span><a href="#section-10.5-3" class="pilcrow">¶</a></p>
<p id="section-10.5-4">]<a href="#section-10.5-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana">
<section id="section-11">
      <h2 id="name-iana-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-11-1">This document has the following actions for IANA.<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">Note to RFC Editor: Please replace all occurrences of "[RFC-XXXX]" with the RFC number of this specification and delete this paragraph.<a href="#section-11-2" class="pilcrow">¶</a></p>
<div id="iana-coap-options">
<section id="section-11.1">
        <h3 id="name-coap-option-numbers-registr">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-coap-option-numbers-registr" class="section-name selfRef">CoAP Option Numbers Registry</a>
        </h3>
<p id="section-11.1-1">IANA is asked to enter the following option numbers to the "CoAP Option Numbers" registry within the "Constrained RESTful Environments (CoRE) Parameters" registry group.<a href="#section-11.1-1" class="pilcrow">¶</a></p>
<span id="name-registrations-in-the-coap-o"></span><div id="tab-iana-coap-option-numbers">
<table class="center" id="table-4">
          <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-registrations-in-the-coap-o" class="selfRef">Registrations in the CoAP Option Numbers Registry</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Number</th>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">TBD1</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast-Timeout</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">TBD2</td>
              <td class="text-left" rowspan="1" colspan="1">Reply-From</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">TBD3</td>
              <td class="text-left" rowspan="1" colspan="1">Group-ETag</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
<div id="iana-message-headers">
<section id="section-11.2">
        <h3 id="name-hypertext-transfer-protocol">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-hypertext-transfer-protocol" class="section-name selfRef">Hypertext Transfer Protocol (HTTP) Field Name Registry</a>
        </h3>
<p id="section-11.2-1">IANA is asked to enter the following HTTP header fields to the "Hypertext Transfer Protocol (HTTP) Field Name" registry.<a href="#section-11.2-1" class="pilcrow">¶</a></p>
<span id="name-registrations-in-the-hypert"></span><div id="tab-iana-http-field-names">
<table class="center" id="table-5">
          <caption>
<a href="#table-5" class="selfRef">Table 5</a>:
<a href="#name-registrations-in-the-hypert" class="selfRef">Registrations in the Hypertext Transfer Protocol (HTTP) Field Name Registry</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field Name</th>
              <th class="text-left" rowspan="1" colspan="1">Status</th>
              <th class="text-left" rowspan="1" colspan="1">Structured Type</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Multicast-Timeout</td>
              <td class="text-left" rowspan="1" colspan="1">permanent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Reply-From</td>
              <td class="text-left" rowspan="1" colspan="1">permanent</td>
              <td class="text-left" rowspan="1" colspan="1">List</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Group-ETag</td>
              <td class="text-left" rowspan="1" colspan="1">permanent</td>
              <td class="text-left" rowspan="1" colspan="1">List</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-12">
      <h2 id="name-references">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-12.1">
        <h3 id="name-normative-references">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-core-groupcomm-bis">[I-D.ietf-core-groupcomm-bis]</dt>
        <dd>
<span class="refAuthor">Dijk, E.</span>, <span class="refAuthor">Wang, C.</span>, and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Group Communication for the Constrained Application Protocol (CoAP)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-groupcomm-bis-11</span>, <time datetime="2024-04-24" class="refDate">24 April 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11">https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-href">[I-D.ietf-core-href]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">H. Birkholz</span>, <span class="refTitle">"Constrained Resource Identifiers"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-href-16</span>, <time datetime="2024-07-24" class="refDate">24 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-href-16">https://datatracker.ietf.org/doc/html/draft-ietf-core-href-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-groupcomm">[I-D.ietf-core-oscore-groupcomm]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Mattsson, J. P.</span>, and <span class="refAuthor">R. Höglund</span>, <span class="refTitle">"Group Object Security for Constrained RESTful Environments (Group OSCORE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-groupcomm-23</span>, <time datetime="2024-09-26" class="refDate">26 September 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-23">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-23</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2046">[RFC2046]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span> and <span class="refAuthor">N. Borenstein</span>, <span class="refTitle">"Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types"</span>, <span class="seriesInfo">RFC 2046</span>, <span class="seriesInfo">DOI 10.17487/RFC2046</span>, <time datetime="1996-11" class="refDate">November 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2046">https://www.rfc-editor.org/rfc/rfc2046</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4648">[RFC4648]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 4648</span>, <span class="seriesInfo">DOI 10.17487/RFC4648</span>, <time datetime="2006-10" class="refDate">October 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4648">https://www.rfc-editor.org/rfc/rfc4648</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5234">[RFC5234]</dt>
        <dd>
<span class="refAuthor">Crocker, D., Ed.</span> and <span class="refAuthor">P. Overell</span>, <span class="refTitle">"Augmented BNF for Syntax Specifications: ABNF"</span>, <span class="seriesInfo">STD 68</span>, <span class="seriesInfo">RFC 5234</span>, <span class="seriesInfo">DOI 10.17487/RFC5234</span>, <time datetime="2008-01" class="refDate">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5234">https://www.rfc-editor.org/rfc/rfc5234</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7252">https://www.rfc-editor.org/rfc/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7641">[RFC7641]</dt>
        <dd>
<span class="refAuthor">Hartke, K.</span>, <span class="refTitle">"Observing Resources in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7641</span>, <span class="seriesInfo">DOI 10.17487/RFC7641</span>, <time datetime="2015-09" class="refDate">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7641">https://www.rfc-editor.org/rfc/rfc7641</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7967">[RFC7967]</dt>
        <dd>
<span class="refAuthor">Bhattacharyya, A.</span>, <span class="refAuthor">Bandyopadhyay, S.</span>, <span class="refAuthor">Pal, A.</span>, and <span class="refAuthor">T. Bose</span>, <span class="refTitle">"Constrained Application Protocol (CoAP) Option for No Server Response"</span>, <span class="seriesInfo">RFC 7967</span>, <span class="seriesInfo">DOI 10.17487/RFC7967</span>, <time datetime="2016-08" class="refDate">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7967">https://www.rfc-editor.org/rfc/rfc7967</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8075">[RFC8075]</dt>
        <dd>
<span class="refAuthor">Castellani, A.</span>, <span class="refAuthor">Loreto, S.</span>, <span class="refAuthor">Rahman, A.</span>, <span class="refAuthor">Fossati, T.</span>, and <span class="refAuthor">E. Dijk</span>, <span class="refTitle">"Guidelines for Mapping Implementations: HTTP to the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 8075</span>, <span class="seriesInfo">DOI 10.17487/RFC8075</span>, <time datetime="2017-02" class="refDate">February 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8075">https://www.rfc-editor.org/rfc/rfc8075</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8323">[RFC8323]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refAuthor">Lemay, S.</span>, <span class="refAuthor">Tschofenig, H.</span>, <span class="refAuthor">Hartke, K.</span>, <span class="refAuthor">Silverajan, B.</span>, and <span class="refAuthor">B. Raymor, Ed.</span>, <span class="refTitle">"CoAP (Constrained Application Protocol) over TCP, TLS, and WebSockets"</span>, <span class="seriesInfo">RFC 8323</span>, <span class="seriesInfo">DOI 10.17487/RFC8323</span>, <time datetime="2018-02" class="refDate">February 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8323">https://www.rfc-editor.org/rfc/rfc8323</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8610">https://www.rfc-editor.org/rfc/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8613">https://www.rfc-editor.org/rfc/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8742">[RFC8742]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR) Sequences"</span>, <span class="seriesInfo">RFC 8742</span>, <span class="seriesInfo">DOI 10.17487/RFC8742</span>, <time datetime="2020-02" class="refDate">February 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8742">https://www.rfc-editor.org/rfc/rfc8742</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9112">[RFC9112]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP/1.1"</span>, <span class="seriesInfo">STD 99</span>, <span class="seriesInfo">RFC 9112</span>, <span class="seriesInfo">DOI 10.17487/RFC9112</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9112">https://www.rfc-editor.org/rfc/rfc9112</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9651">[RFC9651]</dt>
      <dd>
<span class="refAuthor">Nottingham, M.</span> and <span class="refAuthor">P. Kamp</span>, <span class="refTitle">"Structured Field Values for HTTP"</span>, <span class="seriesInfo">RFC 9651</span>, <span class="seriesInfo">DOI 10.17487/RFC9651</span>, <time datetime="2024-09" class="refDate">September 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9651">https://www.rfc-editor.org/rfc/rfc9651</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-12.2">
        <h3 id="name-informative-references">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.amsuess-core-cachable-oscore">[I-D.amsuess-core-cachable-oscore]</dt>
        <dd>
<span class="refAuthor">Amsüss, C.</span> and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Cacheable OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-amsuess-core-cachable-oscore-09</span>, <time datetime="2024-07-08" class="refDate">8 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-amsuess-core-cachable-oscore-09">https://datatracker.ietf.org/doc/html/draft-amsuess-core-cachable-oscore-09</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.bormann-coap-misc">[I-D.bormann-coap-misc]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">K. Hartke</span>, <span class="refTitle">"Miscellaneous additions to CoAP"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-bormann-coap-misc-27</span>, <time datetime="2014-11-14" class="refDate">14 November 2014</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-bormann-coap-misc-27">https://datatracker.ietf.org/doc/html/draft-bormann-coap-misc-27</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-key-groupcomm-oscore">[I-D.ietf-ace-key-groupcomm-oscore]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Park, J.</span>, and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Key Management for OSCORE Groups in ACE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-key-groupcomm-oscore-16</span>, <time datetime="2023-03-06" class="refDate">6 March 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-key-groupcomm-oscore-16">https://datatracker.ietf.org/doc/html/draft-ietf-ace-key-groupcomm-oscore-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-capable-proxies">[I-D.ietf-core-oscore-capable-proxies]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span> and <span class="refAuthor">R. Höglund</span>, <span class="refTitle">"OSCORE-capable Proxies"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-capable-proxies-02</span>, <time datetime="2024-07-08" class="refDate">8 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-capable-proxies-02">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-capable-proxies-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.tiloca-core-oscore-discovery">[I-D.tiloca-core-oscore-discovery]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Amsüss, C.</span>, and <span class="refAuthor">P. Van der Stok</span>, <span class="refTitle">"Discovery of OSCORE Groups with the CoRE Resource Directory"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-tiloca-core-oscore-discovery-16</span>, <time datetime="2024-09-04" class="refDate">4 September 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-tiloca-core-oscore-discovery-16">https://datatracker.ietf.org/doc/html/draft-tiloca-core-oscore-discovery-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9147">[RFC9147]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Tschofenig, H.</span>, and <span class="refAuthor">N. Modadugu</span>, <span class="refTitle">"The Datagram Transport Layer Security (DTLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 9147</span>, <span class="seriesInfo">DOI 10.17487/RFC9147</span>, <time datetime="2022-04" class="refDate">April 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9147">https://www.rfc-editor.org/rfc/rfc9147</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="sec-reverse-proxies-examples">
<section id="appendix-A">
      <h2 id="name-examples-with-reverse-proxy">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-examples-with-reverse-proxy" class="section-name selfRef">Examples with Reverse-Proxy</a>
      </h2>
<p id="appendix-A-1">The examples in this section refer to the following actors.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-2.1">
          <p id="appendix-A-2.1.1">One origin client C, with address C_ADDR and port number C_PORT.<a href="#appendix-A-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.2">
          <p id="appendix-A-2.2.1">One proxy P, with address P_ADDR and server port number P_PORT.<a href="#appendix-A-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.3">
          <p id="appendix-A-2.3.1">Two origin servers S1 and S2, where the server Sx has address Sx_ADDR and port number Sx_PORT.<a href="#appendix-A-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-3">The origin servers are members of a CoAP group with IP multicast address G_ADDR and port number G_PORT. Also, the origin servers are members of a same application group, and share the same resource /r.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<p id="appendix-A-4">The communication between C and P is based on CoAP over TCP, as per <span>[<a href="#RFC8323" class="cite xref">RFC8323</a>]</span>. The group communication between P and the origin servers is based on CoAP over UDP and IP multicast, as per <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>.<a href="#appendix-A-4" class="pilcrow">¶</a></p>
<p id="appendix-A-5">Finally, cri'X' denotes a CRI or CRI reference corresponding to the URI or URI reference X.<a href="#appendix-A-5" class="pilcrow">¶</a></p>
<div id="sec-reverse-proxies-examples-ex1">
<section id="appendix-A.1">
        <h3 id="name-example-1">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-example-1" class="section-name selfRef">Example 1</a>
        </h3>
<p id="appendix-A.1-1">The example shown in <a href="#workflow-example-reverse-1" class="auto internal xref">Figure 2</a> considers a reverse-proxy P that provides access to both the whole group of servers {S1,S2} and also to each of those servers individually. The client C may not have a way to reach the servers directly (e.g., P is acting as a firewall).<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<p id="appendix-A.1-2">After the client C has received two responses to its group request sent via the proxy, it selects one server (S1) and requests another resource from it in unicast, again via the proxy.<a href="#appendix-A.1-2" class="pilcrow">¶</a></p>
<p id="appendix-A.1-3">In particular:<a href="#appendix-A.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.1-4.1">
            <p id="appendix-A.1-4.1.1">In its group request to P, the client C includes the Uri-Host Option with value "group1.com" and the Uri-Path Option with value "r".<a href="#appendix-A.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-4.2">
            <p id="appendix-A.1-4.2.1">The hostname 'group1.com' resolves to the IPv6 multicast address G_ADDR. The proxy P performs this resolution upon receiving the group request from C.<a href="#appendix-A.1-4.2.1" class="pilcrow">¶</a></p>
<p id="appendix-A.1-4.2.2">
Since such a request does not include the Uri-Port Option, P infers G_PORT to be the default port number 5683 for the "coap" URI scheme.<a href="#appendix-A.1-4.2.2" class="pilcrow">¶</a></p>
<p id="appendix-A.1-4.2.3">
Based on this information, P composes the group request and sends it to the CoAP group at G_ADDR:G_PORT.<a href="#appendix-A.1-4.2.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-4.3">
            <p id="appendix-A.1-4.3.1">Typically, S1_PORT and S2_PORT will be equal to G_PORT, but a server Sx is allowed to reply to the multicast request from another port number not equal to G_PORT. For this reason, the notation Sx_PORT is used.<a href="#appendix-A.1-4.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-A.1-5">Note that this type of reverse-proxy only requires one unicast IP address (P_ADDR) for the proxy, so it scales well with a large number of servers Sx. Instead, the type of reverse-proxy in the example in <a href="#sec-reverse-proxies-examples-ex2" class="auto internal xref">Appendix A.2</a> requires one IP address for each server Sx and one for each CoAP group that the proxy supports.<a href="#appendix-A.1-5" class="pilcrow">¶</a></p>
<span id="name-workflow-example-with-a-rev"></span><div id="workflow-example-reverse-1">
<figure id="figure-2">
          <div id="appendix-A.1-6.1">
            <div class="alignLeft art-svg artwork" id="appendix-A.1-6.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1504" width="576" viewBox="0 0 576 1504" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,48 L 8,1488" fill="none" stroke="black"></path>
                <path d="M 304,48 L 304,1056" fill="none" stroke="black"></path>
                <path d="M 304,1104 L 304,1488" fill="none" stroke="black"></path>
                <path d="M 488,48 L 488,520" fill="none" stroke="black"></path>
                <path d="M 488,536 L 488,856" fill="none" stroke="black"></path>
                <path d="M 488,912 L 488,1488" fill="none" stroke="black"></path>
                <path d="M 568,48 L 568,1488" fill="none" stroke="black"></path>
                <path d="M 8,64 L 296,64" fill="none" stroke="black"></path>
                <path d="M 16,176 L 304,176" fill="none" stroke="black"></path>
                <path d="M 8,320 L 296,320" fill="none" stroke="black"></path>
                <path d="M 304,496 L 480,496" fill="none" stroke="black"></path>
                <path d="M 448,528 L 560,528" fill="none" stroke="black"></path>
                <path d="M 312,656 L 488,656" fill="none" stroke="black"></path>
                <path d="M 16,736 L 304,736" fill="none" stroke="black"></path>
                <path d="M 312,864 L 568,864" fill="none" stroke="black"></path>
                <path d="M 16,944 L 304,944" fill="none" stroke="black"></path>
                <path d="M 8,1136 L 296,1136" fill="none" stroke="black"></path>
                <path d="M 304,1312 L 480,1312" fill="none" stroke="black"></path>
                <path d="M 312,1360 L 488,1360" fill="none" stroke="black"></path>
                <path d="M 16,1440 L 304,1440" fill="none" stroke="black"></path>
                <path d="M 432,496 L 448,528" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="568,528 556,522.4 556,533.6" fill="black" transform="rotate(0,560,528)"></polygon>
                <polygon class="arrowhead" points="488,1312 476,1306.4 476,1317.6" fill="black" transform="rotate(0,480,1312)"></polygon>
                <polygon class="arrowhead" points="488,496 476,490.4 476,501.6" fill="black" transform="rotate(0,480,496)"></polygon>
                <polygon class="arrowhead" points="320,1360 308,1354.4 308,1365.6" fill="black" transform="rotate(180,312,1360)"></polygon>
                <polygon class="arrowhead" points="320,864 308,858.4 308,869.6" fill="black" transform="rotate(180,312,864)"></polygon>
                <polygon class="arrowhead" points="320,656 308,650.4 308,661.6" fill="black" transform="rotate(180,312,656)"></polygon>
                <polygon class="arrowhead" points="304,1136 292,1130.4 292,1141.6" fill="black" transform="rotate(0,296,1136)"></polygon>
                <polygon class="arrowhead" points="304,320 292,314.4 292,325.6" fill="black" transform="rotate(0,296,320)"></polygon>
                <polygon class="arrowhead" points="304,64 292,58.4 292,69.6" fill="black" transform="rotate(0,296,64)"></polygon>
                <polygon class="arrowhead" points="24,1440 12,1434.4 12,1445.6" fill="black" transform="rotate(180,16,1440)"></polygon>
                <polygon class="arrowhead" points="24,944 12,938.4 12,949.6" fill="black" transform="rotate(180,16,944)"></polygon>
                <polygon class="arrowhead" points="24,736 12,730.4 12,741.6" fill="black" transform="rotate(180,16,736)"></polygon>
                <polygon class="arrowhead" points="24,176 12,170.4 12,181.6" fill="black" transform="rotate(180,16,176)"></polygon>
                <g class="text">
                  <text x="8" y="36">C</text>
                  <text x="304" y="36">P</text>
                  <text x="492" y="36">S1</text>
                  <text x="564" y="36">S2</text>
                  <text x="320" y="68">/</text>
                  <text x="336" y="68">C</text>
                  <text x="356" y="68">is</text>
                  <text x="384" y="68">not</text>
                  <text x="424" y="68">aware</text>
                  <text x="36" y="84">Src:</text>
                  <text x="112" y="84">C_ADDR:C_PORT</text>
                  <text x="332" y="84">that</text>
                  <text x="360" y="84">P</text>
                  <text x="380" y="84">is</text>
                  <text x="404" y="84">in</text>
                  <text x="436" y="84">fact</text>
                  <text x="36" y="100">Dst:</text>
                  <text x="112" y="100">P_ADDR:P_PORT</text>
                  <text x="320" y="100">a</text>
                  <text x="384" y="100">reverse-proxy</text>
                  <text x="448" y="100">/</text>
                  <text x="56" y="116">Uri-Host:</text>
                  <text x="148" y="116">"group1.com"</text>
                  <text x="56" y="132">Uri-Path:</text>
                  <text x="112" y="132">"r"</text>
                  <text x="36" y="196">Src:</text>
                  <text x="112" y="196">P_ADDR:P_PORT</text>
                  <text x="36" y="212">Dst:</text>
                  <text x="112" y="212">C_ADDR:C_PORT</text>
                  <text x="36" y="228">4.00</text>
                  <text x="72" y="228">Bad</text>
                  <text x="120" y="228">Request</text>
                  <text x="92" y="244">Multicast-Timeout:</text>
                  <text x="176" y="244">-</text>
                  <text x="216" y="244">(empty)</text>
                  <text x="52" y="260">Payload:</text>
                  <text x="120" y="260">"Please</text>
                  <text x="168" y="260">use</text>
                  <text x="108" y="276">Multicast-Timeout"</text>
                  <text x="36" y="340">Src:</text>
                  <text x="112" y="340">C_ADDR:C_PORT</text>
                  <text x="36" y="356">Dst:</text>
                  <text x="112" y="356">P_ADDR:P_PORT</text>
                  <text x="56" y="372">Uri-Host:</text>
                  <text x="148" y="372">"group1.com"</text>
                  <text x="56" y="388">Uri-Path:</text>
                  <text x="112" y="388">"r"</text>
                  <text x="92" y="404">Multicast-Timeout:</text>
                  <text x="180" y="404">60</text>
                  <text x="332" y="452">Src:</text>
                  <text x="408" y="452">P_ADDR:P_PORT</text>
                  <text x="332" y="468">Dst:</text>
                  <text x="408" y="468">G_ADDR:G_PORT</text>
                  <text x="352" y="484">Uri-Path:</text>
                  <text x="408" y="484">"r"</text>
                  <text x="320" y="580">/</text>
                  <text x="336" y="580">t</text>
                  <text x="352" y="580">=</text>
                  <text x="368" y="580">0</text>
                  <text x="384" y="580">:</text>
                  <text x="400" y="580">P</text>
                  <text x="436" y="580">starts</text>
                  <text x="352" y="596">accepting</text>
                  <text x="432" y="596">responses</text>
                  <text x="328" y="612">for</text>
                  <text x="364" y="612">this</text>
                  <text x="416" y="612">request</text>
                  <text x="456" y="612">/</text>
                  <text x="332" y="676">Src:</text>
                  <text x="416" y="676">S1_ADDR:S1_PORT</text>
                  <text x="332" y="692">Dst:</text>
                  <text x="408" y="692">P_ADDR:P_PORT</text>
                  <text x="36" y="756">Src:</text>
                  <text x="112" y="756">P_ADDR:P_PORT</text>
                  <text x="36" y="772">Dst:</text>
                  <text x="112" y="772">C_ADDR:C_PORT</text>
                  <text x="64" y="788">Reply-From:</text>
                  <text x="156" y="804">cri'coap+tcp://P_ADDR:P_PORT',</text>
                  <text x="124" y="820">cri'//S1_ADDR:S1_PORT'</text>
                  <text x="412" y="884">Src:</text>
                  <text x="496" y="884">S2_ADDR:S2_PORT</text>
                  <text x="412" y="900">Dst:</text>
                  <text x="488" y="900">P_ADDR:P_PORT</text>
                  <text x="36" y="964">Src:</text>
                  <text x="112" y="964">P_ADDR:P_PORT</text>
                  <text x="36" y="980">Dst:</text>
                  <text x="112" y="980">C_ADDR:C_PORT</text>
                  <text x="64" y="996">Reply-From:</text>
                  <text x="156" y="1012">cri'coap+tcp://P_ADDR:P_PORT',</text>
                  <text x="124" y="1028">cri'//S2_ADDR:S2_PORT'</text>
                  <text x="176" y="1076">/</text>
                  <text x="196" y="1076">At</text>
                  <text x="216" y="1076">t</text>
                  <text x="232" y="1076">=</text>
                  <text x="256" y="1076">60,</text>
                  <text x="280" y="1076">P</text>
                  <text x="312" y="1076">stops</text>
                  <text x="376" y="1076">accepting</text>
                  <text x="208" y="1092">responses</text>
                  <text x="264" y="1092">for</text>
                  <text x="300" y="1092">this</text>
                  <text x="352" y="1092">request</text>
                  <text x="392" y="1092">/</text>
                  <text x="320" y="1140">/</text>
                  <text x="360" y="1140">Request</text>
                  <text x="428" y="1140">intended</text>
                  <text x="36" y="1156">Src:</text>
                  <text x="112" y="1156">C_ADDR:C_PORT</text>
                  <text x="332" y="1156">only</text>
                  <text x="364" y="1156">to</text>
                  <text x="392" y="1156">S1,</text>
                  <text x="424" y="1156">via</text>
                  <text x="456" y="1156">the</text>
                  <text x="36" y="1172">Dst:</text>
                  <text x="112" y="1172">P_ADDR:P_PORT</text>
                  <text x="336" y="1172">proxy</text>
                  <text x="368" y="1172">P</text>
                  <text x="384" y="1172">/</text>
                  <text x="56" y="1188">Uri-Host:</text>
                  <text x="136" y="1188">"S1_ADDR"</text>
                  <text x="56" y="1204">Uri-Port:</text>
                  <text x="128" y="1204">S1_PORT</text>
                  <text x="56" y="1220">Uri-Path:</text>
                  <text x="116" y="1220">"r1"</text>
                  <text x="332" y="1268">Src:</text>
                  <text x="408" y="1268">P_ADDR:P_PORT</text>
                  <text x="332" y="1284">Dst:</text>
                  <text x="416" y="1284">S1_ADDR:S1_PORT</text>
                  <text x="352" y="1300">Uri-Path:</text>
                  <text x="412" y="1300">"r1"</text>
                  <text x="332" y="1380">Src:</text>
                  <text x="416" y="1380">S1_ADDR:S1_PORT</text>
                  <text x="332" y="1396">Dst:</text>
                  <text x="408" y="1396">P_ADDR:P_PORT</text>
                  <text x="164" y="1460">Src:</text>
                  <text x="240" y="1460">P_ADDR:P_PORT</text>
                  <text x="164" y="1476">Dst:</text>
                  <text x="240" y="1476">C_ADDR:C_PORT</text>
                </g>
              </svg><a href="#appendix-A.1-6.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-workflow-example-with-a-rev" class="selfRef">Workflow Example with a Reverse-Proxy Standing in for Both the Whole Group of Servers and Each Individual Server. This Requires the Proxy to Have Only One Pair (IP Address, Port Number).</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-reverse-proxies-examples-ex2">
<section id="appendix-A.2">
        <h3 id="name-example-2-2">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-example-2-2" class="section-name selfRef">Example 2</a>
        </h3>
<p id="appendix-A.2-1">The example shown in <a href="#workflow-example-reverse-2" class="auto internal xref">Figure 3</a> considers a reverse-proxy that stands in for both the whole group of servers {S1,S2} and for each of those servers Sx. The client C may not have a way to reach the servers directly (e.g., P is acting as a firewall).<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<p id="appendix-A.2-2">After the client C has received two responses to its group request sent via the proxy, it selects one server (S1) and requests at a later time the same resource from it in unicast, again via the proxy.<a href="#appendix-A.2-2" class="pilcrow">¶</a></p>
<p id="appendix-A.2-3">In particular:<a href="#appendix-A.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-4.1">
            <p id="appendix-A.2-4.1.1">When receiving a request addressed to the unicast address P_ADDR and port number P_PORT, the proxy forwards the request towards the CoAP group at G_ADDR:G_PORT leaving the URI path unchanged.<a href="#appendix-A.2-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-4.2">
            <p id="appendix-A.2-4.2.1">The address Dx_ADDR and port number Dx_PORT are also used by the proxy, which forwards an incoming request to that address towards the server at Sx_ADDR:Sx_PORT. The different Dx_ADDR are effectively "proxy IP addresses" used to provide access to the servers.<a href="#appendix-A.2-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-A.2-5">Note that this type of reverse-proxy implementation requires the proxy to use (potentially) a large number of distinct IP addresses, hence it is not very scalable. Instead, the type of reverse-proxy shown in the example in <a href="#sec-reverse-proxies-examples-ex1" class="auto internal xref">Appendix A.1</a> uses only one IPv6 unicast address to provide access to all servers and all CoAP groups.<a href="#appendix-A.2-5" class="pilcrow">¶</a></p>
<span id="name-workflow-example-with-a-reve"></span><div id="workflow-example-reverse-2">
<figure id="figure-3">
          <div id="appendix-A.2-6.1">
            <div class="alignLeft art-svg artwork" id="appendix-A.2-6.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1472" width="576" viewBox="0 0 576 1472" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,48 L 8,1056" fill="none" stroke="black"></path>
                <path d="M 8,1120 L 8,1456" fill="none" stroke="black"></path>
                <path d="M 296,48 L 296,992" fill="none" stroke="black"></path>
                <path d="M 296,1040 L 296,1056" fill="none" stroke="black"></path>
                <path d="M 296,1120 L 296,1456" fill="none" stroke="black"></path>
                <path d="M 480,48 L 480,488" fill="none" stroke="black"></path>
                <path d="M 480,504 L 480,808" fill="none" stroke="black"></path>
                <path d="M 480,864 L 480,1056" fill="none" stroke="black"></path>
                <path d="M 480,1120 L 480,1456" fill="none" stroke="black"></path>
                <path d="M 568,48 L 568,1056" fill="none" stroke="black"></path>
                <path d="M 568,1120 L 568,1456" fill="none" stroke="black"></path>
                <path d="M 8,64 L 288,64" fill="none" stroke="black"></path>
                <path d="M 16,160 L 296,160" fill="none" stroke="black"></path>
                <path d="M 8,304 L 288,304" fill="none" stroke="black"></path>
                <path d="M 296,464 L 472,464" fill="none" stroke="black"></path>
                <path d="M 440,496 L 560,496" fill="none" stroke="black"></path>
                <path d="M 304,624 L 480,624" fill="none" stroke="black"></path>
                <path d="M 16,704 L 296,704" fill="none" stroke="black"></path>
                <path d="M 304,816 L 568,816" fill="none" stroke="black"></path>
                <path d="M 16,896 L 296,896" fill="none" stroke="black"></path>
                <path d="M 8,1152 L 288,1152" fill="none" stroke="black"></path>
                <path d="M 296,1280 L 472,1280" fill="none" stroke="black"></path>
                <path d="M 304,1328 L 480,1328" fill="none" stroke="black"></path>
                <path d="M 16,1408 L 296,1408" fill="none" stroke="black"></path>
                <path d="M 424,464 L 440,496" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="568,496 556,490.4 556,501.6" fill="black" transform="rotate(0,560,496)"></polygon>
                <polygon class="arrowhead" points="480,1280 468,1274.4 468,1285.6" fill="black" transform="rotate(0,472,1280)"></polygon>
                <polygon class="arrowhead" points="480,464 468,458.4 468,469.6" fill="black" transform="rotate(0,472,464)"></polygon>
                <polygon class="arrowhead" points="312,1328 300,1322.4 300,1333.6" fill="black" transform="rotate(180,304,1328)"></polygon>
                <polygon class="arrowhead" points="312,816 300,810.4 300,821.6" fill="black" transform="rotate(180,304,816)"></polygon>
                <polygon class="arrowhead" points="312,624 300,618.4 300,629.6" fill="black" transform="rotate(180,304,624)"></polygon>
                <polygon class="arrowhead" points="296,1152 284,1146.4 284,1157.6" fill="black" transform="rotate(0,288,1152)"></polygon>
                <polygon class="arrowhead" points="296,304 284,298.4 284,309.6" fill="black" transform="rotate(0,288,304)"></polygon>
                <polygon class="arrowhead" points="296,64 284,58.4 284,69.6" fill="black" transform="rotate(0,288,64)"></polygon>
                <polygon class="arrowhead" points="24,1408 12,1402.4 12,1413.6" fill="black" transform="rotate(180,16,1408)"></polygon>
                <polygon class="arrowhead" points="24,896 12,890.4 12,901.6" fill="black" transform="rotate(180,16,896)"></polygon>
                <polygon class="arrowhead" points="24,704 12,698.4 12,709.6" fill="black" transform="rotate(180,16,704)"></polygon>
                <polygon class="arrowhead" points="24,160 12,154.4 12,165.6" fill="black" transform="rotate(180,16,160)"></polygon>
                <g class="text">
                  <text x="8" y="36">C</text>
                  <text x="296" y="36">P</text>
                  <text x="484" y="36">S1</text>
                  <text x="564" y="36">S2</text>
                  <text x="312" y="68">/</text>
                  <text x="328" y="68">C</text>
                  <text x="348" y="68">is</text>
                  <text x="376" y="68">not</text>
                  <text x="416" y="68">aware</text>
                  <text x="36" y="84">Src:</text>
                  <text x="112" y="84">C_ADDR:C_PORT</text>
                  <text x="324" y="84">that</text>
                  <text x="352" y="84">P</text>
                  <text x="372" y="84">is</text>
                  <text x="396" y="84">in</text>
                  <text x="428" y="84">fact</text>
                  <text x="36" y="100">Dst:</text>
                  <text x="112" y="100">P_ADDR:P_PORT</text>
                  <text x="312" y="100">a</text>
                  <text x="376" y="100">reverse-proxy</text>
                  <text x="440" y="100">/</text>
                  <text x="56" y="116">Uri-Path:</text>
                  <text x="112" y="116">"r"</text>
                  <text x="36" y="180">Src:</text>
                  <text x="112" y="180">P_ADDR:P_PORT</text>
                  <text x="36" y="196">Dst:</text>
                  <text x="112" y="196">C_ADDR:C_PORT</text>
                  <text x="36" y="212">4.00</text>
                  <text x="72" y="212">Bad</text>
                  <text x="120" y="212">Request</text>
                  <text x="92" y="228">Multicast-Timeout:</text>
                  <text x="176" y="228">-</text>
                  <text x="216" y="228">(empty)</text>
                  <text x="52" y="244">Payload:</text>
                  <text x="120" y="244">"Please</text>
                  <text x="168" y="244">use</text>
                  <text x="108" y="260">Multicast-Timeout"</text>
                  <text x="36" y="324">Src:</text>
                  <text x="112" y="324">C_ADDR:C_PORT</text>
                  <text x="36" y="340">Dst:</text>
                  <text x="112" y="340">P_ADDR:P_PORT</text>
                  <text x="56" y="356">Uri-Path:</text>
                  <text x="112" y="356">"r"</text>
                  <text x="92" y="372">Multicast-Timeout:</text>
                  <text x="180" y="372">60</text>
                  <text x="324" y="420">Src:</text>
                  <text x="400" y="420">P_ADDR:P_PORT</text>
                  <text x="324" y="436">Dst:</text>
                  <text x="400" y="436">G_ADDR:G_PORT</text>
                  <text x="344" y="452">Uri-Path:</text>
                  <text x="400" y="452">"r"</text>
                  <text x="312" y="548">/</text>
                  <text x="328" y="548">t</text>
                  <text x="344" y="548">=</text>
                  <text x="360" y="548">0</text>
                  <text x="376" y="548">:</text>
                  <text x="392" y="548">P</text>
                  <text x="428" y="548">starts</text>
                  <text x="344" y="564">accepting</text>
                  <text x="424" y="564">responses</text>
                  <text x="320" y="580">for</text>
                  <text x="356" y="580">this</text>
                  <text x="408" y="580">request</text>
                  <text x="448" y="580">/</text>
                  <text x="324" y="644">Src:</text>
                  <text x="408" y="644">S1_ADDR:S1_PORT</text>
                  <text x="324" y="660">Dst:</text>
                  <text x="400" y="660">P_ADDR:P_PORT</text>
                  <text x="36" y="724">Src:</text>
                  <text x="112" y="724">P_ADDR:P_PORT</text>
                  <text x="36" y="740">Dst:</text>
                  <text x="112" y="740">C_ADDR:C_PORT</text>
                  <text x="64" y="756">Reply-From:</text>
                  <text x="160" y="772">cri'coap+tcp://D1_ADDR:D1_PORT'</text>
                  <text x="412" y="836">Src:</text>
                  <text x="496" y="836">S2_ADDR:S2_PORT</text>
                  <text x="412" y="852">Dst:</text>
                  <text x="488" y="852">P_ADDR:P_PORT</text>
                  <text x="36" y="916">Src:</text>
                  <text x="112" y="916">P_ADDR:P_PORT</text>
                  <text x="36" y="932">Dst:</text>
                  <text x="112" y="932">C_ADDR:C_PORT</text>
                  <text x="64" y="948">Reply-From:</text>
                  <text x="160" y="964">cri'coap+tcp://D2_ADDR:D2_PORT'</text>
                  <text x="168" y="1012">/</text>
                  <text x="188" y="1012">At</text>
                  <text x="208" y="1012">t</text>
                  <text x="224" y="1012">=</text>
                  <text x="248" y="1012">60,</text>
                  <text x="272" y="1012">P</text>
                  <text x="304" y="1012">stops</text>
                  <text x="368" y="1012">accepting</text>
                  <text x="200" y="1028">responses</text>
                  <text x="256" y="1028">for</text>
                  <text x="292" y="1028">this</text>
                  <text x="344" y="1028">request</text>
                  <text x="384" y="1028">/</text>
                  <text x="16" y="1092">...</text>
                  <text x="128" y="1092">...</text>
                  <text x="240" y="1092">/</text>
                  <text x="268" y="1092">Time</text>
                  <text x="316" y="1092">passes</text>
                  <text x="352" y="1092">/</text>
                  <text x="480" y="1092">...</text>
                  <text x="560" y="1092">...</text>
                  <text x="312" y="1156">/</text>
                  <text x="352" y="1156">Request</text>
                  <text x="420" y="1156">intended</text>
                  <text x="36" y="1172">Src:</text>
                  <text x="112" y="1172">C_ADDR:C_PORT</text>
                  <text x="324" y="1172">only</text>
                  <text x="356" y="1172">to</text>
                  <text x="380" y="1172">S1</text>
                  <text x="408" y="1172">for</text>
                  <text x="440" y="1172">the</text>
                  <text x="36" y="1188">Dst:</text>
                  <text x="120" y="1188">D1_ADDR:D1_PORT</text>
                  <text x="324" y="1188">same</text>
                  <text x="380" y="1188">resource</text>
                  <text x="428" y="1188">/r</text>
                  <text x="448" y="1188">/</text>
                  <text x="56" y="1204">Uri-Path:</text>
                  <text x="112" y="1204">"r"</text>
                  <text x="324" y="1236">Src:</text>
                  <text x="400" y="1236">P_ADDR:P_PORT</text>
                  <text x="324" y="1252">Dst:</text>
                  <text x="408" y="1252">S1_ADDR:S1_PORT</text>
                  <text x="344" y="1268">Uri-Path:</text>
                  <text x="400" y="1268">"r"</text>
                  <text x="324" y="1348">Src:</text>
                  <text x="408" y="1348">S1_ADDR:S1_PORT</text>
                  <text x="324" y="1364">Dst:</text>
                  <text x="400" y="1364">P_ADDR:P_PORT</text>
                  <text x="140" y="1428">Src:</text>
                  <text x="224" y="1428">D1_ADDR:D1_PORT</text>
                  <text x="140" y="1444">Dst:</text>
                  <text x="216" y="1444">C_ADDR:C_PORT</text>
                </g>
              </svg><a href="#appendix-A.2-6.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-workflow-example-with-a-reve" class="selfRef">Workflow Example With a Reverse-Proxy Standing in for Both the Whole Group of Servers and Each Individual Server. This Requires the Proxy to Have One Pair (IP Address, Port Number) for Each Group and One for Each Origin Server.</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-reverse-proxies-examples-ex3">
<section id="appendix-A.3">
        <h3 id="name-example-3">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-example-3" class="section-name selfRef">Example 3</a>
        </h3>
<p id="appendix-A.3-1">The example shown in <a href="#workflow-example-reverse-3" class="auto internal xref">Figure 4</a> builds on the example in <a href="#sec-reverse-proxies-examples-ex2" class="auto internal xref">Appendix A.2</a>.<a href="#appendix-A.3-1" class="pilcrow">¶</a></p>
<p id="appendix-A.3-2">However, it considers a reverse-proxy that stands in for only the whole group of servers, but not for each individual server Sx. Therefore, it is possible for the client C to reach the servers directly.<a href="#appendix-A.3-2" class="pilcrow">¶</a></p>
<p id="appendix-A.3-3">The final exchange between C and S1 occurs with CoAP over UDP.<a href="#appendix-A.3-3" class="pilcrow">¶</a></p>
<span id="name-workflow-example-with-a-rever"></span><div id="workflow-example-reverse-3">
<figure id="figure-4">
          <div id="appendix-A.3-4.1">
            <div class="alignLeft art-svg artwork" id="appendix-A.3-4.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1296" width="568" viewBox="0 0 568 1296" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,48 L 8,1040" fill="none" stroke="black"></path>
                <path d="M 8,1104 L 8,1280" fill="none" stroke="black"></path>
                <path d="M 264,48 L 264,976" fill="none" stroke="black"></path>
                <path d="M 264,1024 L 264,1040" fill="none" stroke="black"></path>
                <path d="M 264,1104 L 264,1128" fill="none" stroke="black"></path>
                <path d="M 264,1144 L 264,1224" fill="none" stroke="black"></path>
                <path d="M 264,1240 L 264,1280" fill="none" stroke="black"></path>
                <path d="M 448,48 L 448,472" fill="none" stroke="black"></path>
                <path d="M 448,488 L 448,792" fill="none" stroke="black"></path>
                <path d="M 448,840 L 448,1040" fill="none" stroke="black"></path>
                <path d="M 448,1104 L 448,1280" fill="none" stroke="black"></path>
                <path d="M 560,48 L 560,1040" fill="none" stroke="black"></path>
                <path d="M 560,1104 L 560,1280" fill="none" stroke="black"></path>
                <path d="M 8,64 L 256,64" fill="none" stroke="black"></path>
                <path d="M 16,144 L 264,144" fill="none" stroke="black"></path>
                <path d="M 8,288 L 256,288" fill="none" stroke="black"></path>
                <path d="M 264,448 L 440,448" fill="none" stroke="black"></path>
                <path d="M 408,480 L 552,480" fill="none" stroke="black"></path>
                <path d="M 272,608 L 448,608" fill="none" stroke="black"></path>
                <path d="M 16,688 L 264,688" fill="none" stroke="black"></path>
                <path d="M 272,800 L 560,800" fill="none" stroke="black"></path>
                <path d="M 16,880 L 264,880" fill="none" stroke="black"></path>
                <path d="M 8,1136 L 440,1136" fill="none" stroke="black"></path>
                <path d="M 16,1232 L 448,1232" fill="none" stroke="black"></path>
                <path d="M 392,448 L 408,480" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="560,480 548,474.4 548,485.6" fill="black" transform="rotate(0,552,480)"></polygon>
                <polygon class="arrowhead" points="448,1136 436,1130.4 436,1141.6" fill="black" transform="rotate(0,440,1136)"></polygon>
                <polygon class="arrowhead" points="448,448 436,442.4 436,453.6" fill="black" transform="rotate(0,440,448)"></polygon>
                <polygon class="arrowhead" points="280,800 268,794.4 268,805.6" fill="black" transform="rotate(180,272,800)"></polygon>
                <polygon class="arrowhead" points="280,608 268,602.4 268,613.6" fill="black" transform="rotate(180,272,608)"></polygon>
                <polygon class="arrowhead" points="264,288 252,282.4 252,293.6" fill="black" transform="rotate(0,256,288)"></polygon>
                <polygon class="arrowhead" points="264,64 252,58.4 252,69.6" fill="black" transform="rotate(0,256,64)"></polygon>
                <polygon class="arrowhead" points="24,1232 12,1226.4 12,1237.6" fill="black" transform="rotate(180,16,1232)"></polygon>
                <polygon class="arrowhead" points="24,880 12,874.4 12,885.6" fill="black" transform="rotate(180,16,880)"></polygon>
                <polygon class="arrowhead" points="24,688 12,682.4 12,693.6" fill="black" transform="rotate(180,16,688)"></polygon>
                <polygon class="arrowhead" points="24,144 12,138.4 12,149.6" fill="black" transform="rotate(180,16,144)"></polygon>
                <g class="text">
                  <text x="8" y="36">C</text>
                  <text x="264" y="36">P</text>
                  <text x="452" y="36">S1</text>
                  <text x="556" y="36">S2</text>
                  <text x="280" y="68">/</text>
                  <text x="296" y="68">C</text>
                  <text x="316" y="68">is</text>
                  <text x="344" y="68">not</text>
                  <text x="384" y="68">aware</text>
                  <text x="36" y="84">Src:</text>
                  <text x="112" y="84">C_ADDR:C_PORT</text>
                  <text x="292" y="84">that</text>
                  <text x="320" y="84">P</text>
                  <text x="340" y="84">is</text>
                  <text x="364" y="84">in</text>
                  <text x="396" y="84">fact</text>
                  <text x="36" y="100">Dst:</text>
                  <text x="112" y="100">P_ADDR:P_PORT</text>
                  <text x="280" y="100">a</text>
                  <text x="344" y="100">reverse-proxy</text>
                  <text x="408" y="100">/</text>
                  <text x="56" y="116">Uri-Path:</text>
                  <text x="112" y="116">"r"</text>
                  <text x="36" y="164">Src:</text>
                  <text x="112" y="164">P_ADDR:P_PORT</text>
                  <text x="36" y="180">Dst:</text>
                  <text x="112" y="180">C_ADDR:C_PORT</text>
                  <text x="36" y="196">4.00</text>
                  <text x="72" y="196">Bad</text>
                  <text x="120" y="196">Request</text>
                  <text x="92" y="212">Multicast-Timeout:</text>
                  <text x="176" y="212">-</text>
                  <text x="216" y="212">(empty)</text>
                  <text x="52" y="228">Payload:</text>
                  <text x="120" y="228">"Please</text>
                  <text x="168" y="228">use</text>
                  <text x="108" y="244">Multicast-Timeout"</text>
                  <text x="36" y="308">Src:</text>
                  <text x="112" y="308">C_ADDR:C_PORT</text>
                  <text x="36" y="324">Dst:</text>
                  <text x="112" y="324">P_ADDR:P_PORT</text>
                  <text x="56" y="340">Uri-Path:</text>
                  <text x="112" y="340">"r"</text>
                  <text x="92" y="356">Multicast-Timeout:</text>
                  <text x="180" y="356">60</text>
                  <text x="292" y="404">Src:</text>
                  <text x="368" y="404">P_ADDR:P_PORT</text>
                  <text x="292" y="420">Dst:</text>
                  <text x="368" y="420">G_ADDR:G_PORT</text>
                  <text x="312" y="436">Uri-Path:</text>
                  <text x="368" y="436">"r"</text>
                  <text x="280" y="532">/</text>
                  <text x="296" y="532">t</text>
                  <text x="312" y="532">=</text>
                  <text x="328" y="532">0</text>
                  <text x="344" y="532">:</text>
                  <text x="360" y="532">P</text>
                  <text x="396" y="532">starts</text>
                  <text x="312" y="548">accepting</text>
                  <text x="392" y="548">responses</text>
                  <text x="288" y="564">for</text>
                  <text x="324" y="564">this</text>
                  <text x="376" y="564">request</text>
                  <text x="416" y="564">/</text>
                  <text x="292" y="628">Src:</text>
                  <text x="376" y="628">S1_ADDR:S1_PORT</text>
                  <text x="292" y="644">Dst:</text>
                  <text x="368" y="644">P_ADDR:P_PORT</text>
                  <text x="36" y="708">Dst:</text>
                  <text x="112" y="708">P_ADDR:P_PORT</text>
                  <text x="36" y="724">Dst:</text>
                  <text x="112" y="724">C_ADDR:C_PORT</text>
                  <text x="64" y="740">Reply-From:</text>
                  <text x="144" y="756">cri'coap://S1_ADDR:S1_PORT'</text>
                  <text x="404" y="820">Src:</text>
                  <text x="488" y="820">S2_ADDR:S2_PORT</text>
                  <text x="404" y="836">Dst:</text>
                  <text x="480" y="836">P_ADDR:P_PORT</text>
                  <text x="36" y="900">Dst:</text>
                  <text x="112" y="900">P_ADDR:P_PORT</text>
                  <text x="36" y="916">Dst:</text>
                  <text x="112" y="916">C_ADDR:C_PORT</text>
                  <text x="64" y="932">Reply-From:</text>
                  <text x="144" y="948">cri'coap://S2_ADDR:S2_PORT'</text>
                  <text x="136" y="996">/</text>
                  <text x="156" y="996">At</text>
                  <text x="176" y="996">t</text>
                  <text x="192" y="996">=</text>
                  <text x="216" y="996">60,</text>
                  <text x="240" y="996">P</text>
                  <text x="272" y="996">stops</text>
                  <text x="336" y="996">accepting</text>
                  <text x="168" y="1012">responses</text>
                  <text x="224" y="1012">for</text>
                  <text x="260" y="1012">this</text>
                  <text x="312" y="1012">request</text>
                  <text x="352" y="1012">/</text>
                  <text x="16" y="1076">...</text>
                  <text x="128" y="1076">...</text>
                  <text x="208" y="1076">/</text>
                  <text x="236" y="1076">Time</text>
                  <text x="284" y="1076">passes</text>
                  <text x="320" y="1076">/</text>
                  <text x="448" y="1076">...</text>
                  <text x="552" y="1076">...</text>
                  <text x="36" y="1156">Src:</text>
                  <text x="112" y="1156">C_ADDR:C_PORT</text>
                  <text x="280" y="1156">/</text>
                  <text x="320" y="1156">Request</text>
                  <text x="388" y="1156">intended</text>
                  <text x="36" y="1172">Dst:</text>
                  <text x="120" y="1172">S1.ADDR:S1_PORT</text>
                  <text x="292" y="1172">only</text>
                  <text x="324" y="1172">to</text>
                  <text x="348" y="1172">S1</text>
                  <text x="376" y="1172">for</text>
                  <text x="408" y="1172">the</text>
                  <text x="56" y="1188">Uri-Path:</text>
                  <text x="112" y="1188">"r"</text>
                  <text x="292" y="1188">same</text>
                  <text x="348" y="1188">resource</text>
                  <text x="396" y="1188">/r</text>
                  <text x="416" y="1188">/</text>
                  <text x="292" y="1252">Src:</text>
                  <text x="376" y="1252">S1.ADDR:S1_PORT</text>
                  <text x="292" y="1268">Dst:</text>
                  <text x="368" y="1268">C_ADDR:C_PORT</text>
                </g>
              </svg><a href="#appendix-A.3-4.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-workflow-example-with-a-rever" class="selfRef">Workflow Example with a Reverse-Proxy Standing in for Only the Whole Group of Servers, but Not for Each Individual Server. This Requires the Proxy to Have One Pair (IP Address, Port Number) for Each Group.</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="sec-document-updates">
<section id="appendix-B">
      <h2 id="name-document-updates">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-document-updates" class="section-name selfRef">Document Updates</a>
      </h2>
<p id="appendix-B-1">This section is to be removed before publishing as an RFC.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<div id="sec-02-03">
<section id="appendix-B.1">
        <h3 id="name-version-02-to-03">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-version-02-to-03" class="section-name selfRef">Version -02 to -03</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.1-1.1">
            <p id="appendix-B.1-1.1.1">Made RFC 7967 a normative reference.<a href="#appendix-B.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.2">
            <p id="appendix-B.1-1.2.1">Improved error handling for request reception at the proxy.<a href="#appendix-B.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.3">
            <p id="appendix-B.1-1.3.1">Improved security considerations for the new CoAP options.<a href="#appendix-B.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.4">
            <p id="appendix-B.1-1.4.1">Aligned handling of multiple responses with draft-ietf-core-groupcomm-bis.<a href="#appendix-B.1-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.5">
            <p id="appendix-B.1-1.5.1">Revised HTTP Reply-From header field to be a Structured Header Field.<a href="#appendix-B.1-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.6">
            <p id="appendix-B.1-1.6.1">Revised HTTP Group-ETag header field to be a Structured Header Field.<a href="#appendix-B.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.7">
            <p id="appendix-B.1-1.7.1">Clarifications and editorial improvements.<a href="#appendix-B.1-1.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-01-02">
<section id="appendix-B.2">
        <h3 id="name-version-01-to-02">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-version-01-to-02" class="section-name selfRef">Version -01 to -02</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.2-1.1">
            <p id="appendix-B.2-1.1.1">Reply-To Option renamed as Reply-From.<a href="#appendix-B.2-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.2">
            <p id="appendix-B.2-1.2.1">Multicast-Timeout Option set to 0 ultimately yields an empty value.<a href="#appendix-B.2-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.3">
            <p id="appendix-B.2-1.3.1">Removed moot text on reverse-proxies that might use default timeouts.<a href="#appendix-B.2-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.4">
            <p id="appendix-B.2-1.4.1">Improved description on using Proxy-Cri and Proxy-Scheme-Number.<a href="#appendix-B.2-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.5">
            <p id="appendix-B.2-1.5.1">Improved error handling for inadequate timeouts with proxy chains.<a href="#appendix-B.2-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.6">
            <p id="appendix-B.2-1.6.1">Revised the examples of message exchange with a reverse-proxy.<a href="#appendix-B.2-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.7">
            <p id="appendix-B.2-1.7.1">Fixes in the IANA considerations.<a href="#appendix-B.2-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.8">
            <p id="appendix-B.2-1.8.1">Editorial fixes and improvements.<a href="#appendix-B.2-1.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-00-01">
<section id="appendix-B.3">
        <h3 id="name-version-00-to-01">
<a href="#appendix-B.3" class="section-number selfRef">B.3. </a><a href="#name-version-00-to-01" class="section-name selfRef">Version -00 to -01</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.3-1.1">
            <p id="appendix-B.3-1.1.1">Definition of "individual request" in the terminology.<a href="#appendix-B.3-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.2">
            <p id="appendix-B.3-1.2.1">UDP/IP multicast treated as the default transport protocol.<a href="#appendix-B.3-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.3">
            <p id="appendix-B.3-1.3.1">Always use the Multicast-Timeout Option, also with reverse-proxies.<a href="#appendix-B.3-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.4">
            <p id="appendix-B.3-1.4.1">Response-Forwarding Option:<a href="#appendix-B.3-1.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.3-1.4.2.1">
                <p id="appendix-B.3-1.4.2.1.1">Renamed as "Reply-To".<a href="#appendix-B.3-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-B.3-1.4.2.2">
                <p id="appendix-B.3-1.4.2.2.1">Revised encoding to use CRIs.<a href="#appendix-B.3-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-B.3-1.4.2.3">
                <p id="appendix-B.3-1.4.2.3.1">Revised semantics to better address setups with reverse-proxies.<a href="#appendix-B.3-1.4.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-B.3-1.4.2.4">
                <p id="appendix-B.3-1.4.2.4.1">Added before possible response caching.<a href="#appendix-B.3-1.4.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-B.3-1.5">
            <p id="appendix-B.3-1.5.1">Clarified response processing at reverse-proxies.<a href="#appendix-B.3-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.6">
            <p id="appendix-B.3-1.6.1">Updated IANA considerations.<a href="#appendix-B.3-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.7">
            <p id="appendix-B.3-1.7.1">Editorial fixes and improvements.<a href="#appendix-B.3-1.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-C">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-C-1">The authors sincerely thank <span class="contact-name">Christian Amsüss</span>, <span class="contact-name">Carsten Bormann</span>, <span class="contact-name">Rikard Höglund</span>, <span class="contact-name">Jim Schaad</span>, and <span class="contact-name">Göran Selander</span> for their comments and feedback.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<p id="appendix-C-2">The work on this document has been partly supported by the Sweden's Innovation Agency VINNOVA and the Celtic-Next projects CRITISEC and CYPRESS; and by the H2020 project SIFIS-Home (Grant agreement 952652).<a href="#appendix-C-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Marco Tiloca</span></div>
<div dir="auto" class="left"><span class="org">RISE AB</span></div>
<div dir="auto" class="left"><span class="street-address">Isafjordsgatan 22</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440 Stockholm</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:marco.tiloca@ri.se" class="email">marco.tiloca@ri.se</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Esko Dijk</span></div>
<div dir="auto" class="left"><span class="org">IoTconsultancy.nl</span></div>
<div dir="auto" class="left"><span class="locality">Utrecht</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:esko.dijk@iotconsultancy.nl" class="email">esko.dijk@iotconsultancy.nl</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
